parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"yaW9":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("winston"));require("express-async-errors");const{combine:n,timestamp:a,label:l,printf:o}=t.default.format,s=o(({level:e,message:t,label:n,timestamp:a})=>`${a} [${n}] ${e}: ${t}`);function r(){t.default.exceptions.handle(new t.default.transports.File({filename:"uncaughtExceptions.log",handleExceptions:!1})),process.on("unhandledRejection",e=>{throw e}),t.default.add(new t.default.transports.File({filename:"logfile.log",format:n(l({label:"Dengine"}),a(),s)})),"production"!==process.env.NODE_ENV&&t.default.add(new t.default.transports.Console({format:t.default.format.simple()}))}exports.default=r;
},{}],"irtd":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("fs")),a=e(require("util")),n=e(require("config")),i=e(require("jsonwebtoken")),o=e(require("random-string-generator")),r=a.default.promisify(t.default.readFile),s=e=>["user","settings","transmission",...e.split(",").map(m())];function m(){return e=>e.trim().replace(" ","-").toLowerCase()}function c(e,t,a){return e.replace(new RegExp(t,"g"),a)}exports.CONSTS={JWT_PRIVATE_KEY:"production"===process.env.NODE_ENV?o.default("alphanumeric"):"sfeefv",DB:n.default.get("db"),DEV_INSTANCEURL:n.default.get("devInstanceURL"),TEST_INSTANCEURL:n.default.get("testInstanceURL"),PROD_INSTANCEURL:n.default.get("prodInstanceURL"),GTMVERSION:n.default.get("gtmVersion"),CURRENT_INSTANCE:n.default.get("currentInstance"),IS_CLIENT:n.default.get("isClient"),SCHEMA_URI:n.default.get("schemaURI"),CLIENT_TOKEN:n.default.get("clientToken"),SUBSCIPTION:s(n.default.get("subsciption"))},exports.getFileData=(async e=>await r(e,"UTF-8")),exports.capitalize=(e=>e.toLowerCase().replace(/\b./g,function(e){return e.toUpperCase()})),exports.getXMlVersion=(e=>{const t=e.match(/xmlns="(.*?)"/),a=e.match(/otm="(.*?)"/),n=e.match(/gtm="(.*?)"/);if(!t)return{gtmVersion:null,xmlNsOtm:null,xmlNsGtm:null};const i=t[1].split("v");return{gtmVersion:+i[i.length-1],xmlNsOtm:a[1],xmlNsGtm:n[1]}}),exports.NAME={release:{Source_Location_Domain_Name:"Source Location DomainName",Source_Location_ID:"Source Location ID",Destination_Location_Domain_Name:"Destination Location DomainName",Destination_Location_ID:"Destination Location ID",Order_Configuration:"Order Configuration",Line_Item_Domain_Name:"Line Item DomainName",Line_Item_ID:"Line Item ID"},location:{AddressLine:"Address Line",AddressLineSequenceNumber:"Address Line Sequence Number"},party:{Location_ID_Domain_Name:"Location ID DomainName",Location_ID:"Location ID",Location_Transaction_Code:"Location TransactionCode",Country_Code_3_ID:"Country Code 3 ID",AddressLine:"Address Line",AddressLineSequenceNumber:"Address Line Sequence Number"},transaction:{Gtm_Transaction_ID_Domain_Name:"Transaction ID DomainName",Gtm_Transaction_ID:"Transaction ID",Gtm_Transaction_Line_ID_Domain_Name:"Line ID DomainName",Gtm_Transaction_Line_ID:"Line ID"},bom:{},orderBase:{Source_Location_Domain_Name:"Source Location DomainName",Source_Location_ID:"Source Location ID",Destination_Location_Domain_Name:"Destination Location DomainName",Destination_Location_ID:"Destination Location ID",Order_Configuration:"Order Configuration",Line_Item_Domain_Name:"Line Item DomainName",Line_Item_ID:"Line Item ID",Early_Pickup_Dt:"EarlyPickup Date",Early_Pickup_TZID:"EarlyPickup TimeZone",Early_Pickup_TZOffset:"EarlyPickup TimeZoneOffset",Late_Pickup_Dt:"LatePickup Date",Late_Pickup_TZID:"LatePickup TimeZone",Late_Pickup_TZOffset:"LatePickup TimeZoneOffset",Early_Delivery_Dt:"EarlyDelivery Date",Early_Delivery_TZID:"EarlyDelivery TimeZone",Early_Delivery_TZOffset:"EarlyDelivery TimeZoneOffset",Late_Delivery_Dt:"LateDelivery Date",Late_Delivery_TZID:"LateDelivery TimeZone",Late_Delivery_TZOffset:"LateDelivery TimeZoneOffset",Order_Base_Line_Packaged_Item_Count:"Line PackagedItem Count"},trackingEvent:{Shipment_ID:"Shipment ID"},shipment:{Equipment_Group_ID_DomainName:"Equipment Group ID DomainName",Equipment_Group_ID:"Equipment Group ID",Equipment_ID_DomainName:"Equipment ID DomainName",Equipment_ID:"Equipment ID",StartDt:"Start Date",EndDt:"End Date",ArrivalTime:"Arrival Time"}},exports.asyncHandler=(async e=>{const t={data:"",error:""};try{const{data:n}=await e;t.data=n}catch(a){t.error=a.error}return t.data||t.error||(t.error="Something failed!"),t}),exports.generateAuthToken=function(e){return i.default.sign({...e},exports.CONSTS.JWT_PRIVATE_KEY,{expiresIn:"12h"})},exports.getReportUrl=(e=>`/GC3/glog.webserver.transmission.ITransactionDetailServlet/1556964221938?ct=NzU0OTQ3NTc2Nzg3NTk4MjE5Mw%3D%3D&id=${e}&is_new_window=true`),exports.getViewUrl=(()=>"/GC3/glog.webserver.finder.WindowOpenFramesetServlet/1563245261188?ct=MTc2NDM0MTg3ODk1NjM1MjU0MQ%3D%3D&bcKey=MTU2MzI0MzAwOTU2NDoy&url=GTM_OTM_OBJECTCustManagement%3Fmanager_layout_gid%3DGTM_OTM_MANAGER_LAYOUT_GID%26management_action%3Dview%26finder_set_gid%3DGTM_OTM_FINDER_SET%26pk%3DGTM_OTM_OBJECT_GID"),exports.getSidebar=(e=>[{name:"Item",link:"item",icon:"shopping_cart",api:"items",display:!0},{name:"Party",link:"party",icon:"business",api:"party",display:!0},{name:"Location",link:"location",icon:"add_location",api:"location",display:!0},{name:"Transaction",link:"transaction",icon:"swap_horizontal_circle",api:"transactions",display:!0},{name:"Order Base",link:"order-base",icon:"store",api:"order-base",display:!0},{name:"Order Release",link:"order-release",icon:"airport_shuttle",api:"order-release",display:!0},{name:"Bom",link:"bom",icon:"ballot",api:"bom",display:!0},{name:"Shipment",link:"shipment",icon:"directions_boat",api:"shipment",display:!0},{name:"Tracking Event",link:"tracking-event",icon:"gps_fixed",api:"tracking-event",display:!0},{name:"Audit",link:"admin/audit",icon:"history",api:"audit",display:e},{name:"Settings",link:"admin/settings",icon:"settings",api:"settings",display:e}]),exports.convertPath=((e,t)=>{const a={newPath:e,newName:e},n=new RegExp(`${t}.`+"[0-9]."),i=e.match(n);return i?(a.newPath=e.replace(i[0],`${t}.INDEX.`),a.newName=e.replace(i[0],`${t}.`)):a.newPath=e.replace(`${t}.`,`${t}.INDEX.`),a.newPath.match(/\.[0-9]\./)?(a.newPath=c(a.newPath,/\.[0-9]\./,".INDEX."),a.newName=a.newPath.replace(/INDEX\./g,""),a):a}),exports.asyncRouteHandler=(e=>(t,a,n)=>{Promise.resolve(e(t,a,n)).catch(n)}),exports.getDomainName=((e,t)=>e.split(".")[1]?{path:`${t}`,value:e.split(".")[0]}:{path:t,value:"PUBLIC"}),exports.getXID=((e,t)=>e.split(".")[1]?{path:`${t}`,value:e.split(".")[1]}:{path:`${t}`,value:e}),exports.getSequence=((e,t,a)=>({path:`${t}`,value:a+1})),exports.getTC=((e,t)=>({path:`${t}`,value:"IU"}));
},{}],"JZWk":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./other"),r=e(require("simple-crypto-js")),u=t.CONSTS.JWT_PRIVATE_KEY;exports.encrypt=(e=>{return new r.default(u).encrypt(e)}),exports.decrypt=(e=>{return new r.default(u).decrypt(e)});
},{"./other":"irtd"}],"KJs0":[function(require,module,exports) {
"use strict";var e=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("curlrequest"));exports.wmServlet=((e,t,o,n)=>{const a={url:e+"/GC3/glog.integration.servlet.WMServlet",retries:30,data:t,headers:{"content-type":"text/xml",Authorization:"Basic "+Buffer.from(o+":"+n).toString("base64")}};return new Promise((e,t)=>{const o={data:"",error:""};r.request(a,function(r,n){r?(o.error=r,t(o)):(o.data=n,e(o))})})}),exports.dbXml=((e,t,o,n)=>{const a={url:e+"/GC3/glog.integration.servlet.DBXMLServlet?command=xmlExport",retries:30,data:t,headers:{"content-type":"text/xml",Authorization:"Basic "+Buffer.from(o+":"+n).toString("base64")}};return new Promise((e,t)=>{const o={data:"",error:""};r.request(a,function(r,n){r?(o.error=r,t(o)):(o.data=n,e(o))})})});
},{}],"ijEX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const R=require("../api/gtm");exports.authDengineUser=(async({url:_,username:E,password:e})=>{const L=`<sql2xml><Query><RootName>GL_USER_ACR_ROLE</RootName><Statement>${`SELECT NVL((SELECT NVL((SELECT (select ACR_ROLE_GID from GL_USER_ACR_ROLE  WHERE GL_USER_GID = '${E}' AND ACR_ROLE_GID LIKE '%GTM - DATA_UPLOAD_ADMIN' AND ROWNUM=1) GTM_CURRENT_USER_ACL FROM DUAL),(SELECT (select ACR_ROLE_GID from GL_USER_ACR_ROLE  WHERE GL_USER_GID = '${E}' AND ACR_ROLE_GID LIKE '%GTM - DATA_UPLOAD_USER' AND ROWNUM=1)  FROM DUAL))  FROM DUAL ),'NOT_AUTHORISED') GTM_CURRENT_USER_ACL FROM DUAL`}</Statement></Query></sql2xml>`;return R.dbXml(_,L,E,e)});
},{"../api/gtm":"KJs0"}],"hXw8":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("joi")),t=require("./../helper/other"),s=require("./../helper/encrypt"),n=e(require("express")),a=require("../helper/gtmAuth"),u=n.default.Router();function i(e){const t={username:r.default.string().min(1).max(30).required(),password:r.default.string().min(1).max(255).required()};return r.default.validate(e,t)}u.post("/",t.asyncRouteHandler(async(e,r)=>{const{error:n}=i(e.body);if(n)return r.status(400).send(n.details[0].message);let{username:u,password:d,instance:c}=e.body;c||(c=t.CONSTS.CURRENT_INSTANCE);const l={username:u,password:d,url:o(c)},{data:S,error:m}=await t.asyncHandler(a.authDengineUser(l));if(S.includes("Unauthorized"))return r.status(403).send("Sorry, you don't have access!");if(m)return r.status(500).send(m);if(S.toString().includes("error"))return r.status(500).send(S.match("<error>(.*)</error>")[1]);const p=S.match('GTM - DATA_UPLOAD_(.*)"')[1].trim();if("ADMIN"!==p&&"USER"!==p)return r.status(403).send("Sorry, you don't have access!");const N="ADMIN"===p,f=s.encrypt(d),T=t.getSidebar(N).filter(e=>t.CONSTS.SUBSCIPTION.includes(e.name.trim().toLowerCase().replace(" ","-"))),h=u.split(".")[0],y=t.generateAuthToken({username:u,domain:h,isAdmin:N,crypto:f,instance:c,sidebar:T});return r.send({data:y})}));const o=e=>"dev"===e?t.CONSTS.DEV_INSTANCEURL:"test"===e?t.CONSTS.TEST_INSTANCEURL:"prod"===e?t.CONSTS.PROD_INSTANCEURL:void 0;exports.default=u;
},{"./../helper/other":"irtd","./../helper/encrypt":"JZWk","../helper/gtmAuth":"ijEX"}],"MNoc":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("jsonwebtoken")),r=require("../helper/other"),s=require("../helper/encrypt");async function n(e,n,u){const c=e.header("x-auth-token");if(!c)return n.status(401).send("Access denied. No token provided.");const d=e.baseUrl.split("/");if(!r.CONSTS.SUBSCIPTION.includes(d[d.length-1]))return n.status(401).send("Sorry, you don't have access.");try{const d=t.default.verify(c,r.CONSTS.JWT_PRIVATE_KEY);e.user=d,e.user.url=o(d),e.user.crypto&&(e.user.password=s.decrypt(d.crypto).toString()),u()}catch(i){n.status(400).send("Invalid token.")}}exports.default=n;const o=e=>{const{instance:t}=e;return"test"===t?r.CONSTS.TEST_INSTANCEURL:"prod"===t?r.CONSTS.PROD_INSTANCEURL:r.CONSTS.DEV_INSTANCEURL};
},{"../helper/other":"irtd","../helper/encrypt":"JZWk"}],"zMRv":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("../middleware/auth")),t=e(require("express")),s=require("../helper/other"),a=t.default.Router();a.get("/me",[r.default],s.asyncRouteHandler(async(e,r)=>{const{username:t,isAdmin:s,instance:a,sidebar:u}=e.user,i=t.split(".")[0];return r.send({data:{username:t,domain:i,isAdmin:s,instance:a,sidebar:u}})})),exports.default=a;
},{"../middleware/auth":"MNoc","../helper/other":"irtd"}],"bJb7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getItemPropfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(ITEM_REFNUM_QUAL_GID,',') within group (order by ITEM_REFNUM_QUAL_GID) FROM ITEM_REFNUM_QUAL) REFNUMS, (SELECT listagg(ITEM_FEATURE_QUAL_GID,',') within group (order by ITEM_FEATURE_QUAL_GID) FROM ITEM_FEATURE_QUAL) ITEMFEATURES, (SELECT listagg(GTM_PROD_CLASS_TYPE_GID,',') within group (order by GTM_PROD_CLASS_TYPE_GID) FROM GTM_PROD_CLASS_TYPE) GTMITEMCLASSIFICATIONS, (SELECT listagg(GTM_LANGUAGE_GID ||'::'|| LANGUAGE_NAME,',') within group (order by GTM_LANGUAGE_GID ||'::'|| LANGUAGE_NAME) FROM GTM_LANGUAGE ) GTMITEMDESCRIPTIONS from dual\n</Statement></Query></sql2xml>",exports.getReleasePropsfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(ORDER_RELEASE_REFNUM_QUAL_GID,',') within group (order by ORDER_RELEASE_REFNUM_QUAL_GID) FROM ORDER_RELEASE_REFNUM_QUAL) RELEASE_REFNUMS, (SELECT listagg(OR_LINE_REFNUM_QUAL_GID,',') within group (order by OR_LINE_REFNUM_QUAL_GID) FROM ORDER_RELEASE_LINE_REFNUM_QUAL) RELEASE_lINE_REFNUMS, (SELECT listagg(INVOLVED_PARTY_QUAL_GID,',') within group (order by INVOLVED_PARTY_QUAL_GID) FROM INVOLVED_PARTY_QUAL) INVOLVED_PARTY, (SELECT listagg(ITEM_FEATURE_QUAL_GID,',') within group (order by ITEM_FEATURE_QUAL_GID) FROM ITEM_FEATURE_QUAL) lINE_ITEM_ATTRIBUTE from dual\n</Statement></Query></sql2xml>",exports.getLocationPropfromOtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(LOCATION_REFNUM_QUAL_GID,',') within group (order by LOCATION_REFNUM_QUAL_GID) FROM LOCATION_REFNUM_QUAL) REFNUMS from dual\n</Statement></Query></sql2xml>",exports.getBomPropsfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(GTM_STRUCTURE_REFNUM_QUAL_GID,',') within group (order by GTM_STRUCTURE_REFNUM_QUAL_GID) FROM GTM_STRUCTURE_REFNUM_QUAL) REFNUMS, (SELECT listagg(GTM_STR_COMP_REFNUM_QUAL_GID,',') within group (order by GTM_STR_COMP_REFNUM_QUAL_GID) FROM GTM_STR_COMPONENT_REFNUM_QUAL) COMPONENT_REFNUMS, (SELECT listagg(INVOLVED_PARTY_QUAL_GID,',') within group (order by INVOLVED_PARTY_QUAL_GID) FROM INVOLVED_PARTY_QUAL) INVOLVED_PARTY from dual\n</Statement></Query></sql2xml>",exports.getTransactionPropsfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (select listagg(DATE_QUALIFIER_GID, ',') within group (order by DATE_QUALIFIER_GID) from (select DATE_QUALIFIER_GID, sum(length(DATE_QUALIFIER_GID) + 2) over (order by DATE_QUALIFIER_GID) running_length from GTM_DATE_QUALIFIER) where running_length &lt; 4000) DATES, (select listagg(GTM_QUANTITY_TYPE_GID ||'['||TYPE||']' , ',') within group (order by GTM_QUANTITY_TYPE_GID) from GTM_QUANTITY_TYPE) QUANTITY,(select listagg(GTM_VALUE_QUALIFIER_GID, ',') within group (order by GTM_VALUE_QUALIFIER_GID) from (select GTM_VALUE_QUALIFIER_GID, sum(length(GTM_VALUE_QUALIFIER_GID) + 2) over (order by GTM_VALUE_QUALIFIER_GID) running_length from GTM_VALUE_QUALIFIER) where running_length &lt; 4000) CURRENCY,(SELECT listagg(GTM_TRANS_REFNUM_QUAL_GID,',') within group (order by GTM_TRANS_REFNUM_QUAL_GID) FROM GTM_TRANS_REFNUM_QUAL) GTMTRANS_REFNUMS, (SELECT listagg(GTM_TRANSLINE_REFNUM_QUAL_GID,',') within group (order by GTM_TRANSLINE_REFNUM_QUAL_GID) FROM GTM_TRANSLINE_REFNUM_QUAL) GTMTRANSACTION_lINE_REFNUMS, (SELECT listagg(INVOLVED_PARTY_QUAL_GID,',') within group (order by INVOLVED_PARTY_QUAL_GID) FROM INVOLVED_PARTY_QUAL) INVOLVED_PARTY,(SELECT listagg(CURRENCY_GID,',') within group (order by CURRENCY_GID) FROM CURRENCY) CURRENCY_UOM,(SELECT listagg(UOM_CODE||'['||TYPE||']',',') within group (order by UOM_CODE) FROM UOM where UOM_CODE in (select distinct UOM_CODE from GTM_TRANSACTION_QUANTITY)) QUANTITY_UOM from dual\n</Statement></Query></sql2xml>",exports.getPartyPropfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(GTM_PARTY_REFNUM_QUAL_GID,',') within group (order by GTM_PARTY_REFNUM_QUAL_GID) FROM GTM_PARTY_REFNUM_QUAL) CONTACT_REFNUMS from dual\n</Statement></Query></sql2xml>",exports.getOrderBasePropsfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(OB_REFNUM_QUAL_GID,',') within group (order by OB_REFNUM_QUAL_GID) FROM OB_REFNUM_QUAL) ORDER_BASE_REFNUMS, (SELECT listagg(OB_LINE_REFNUM_QUAL_GID,',') within group (order by OB_LINE_REFNUM_QUAL_GID) FROM OB_LINE_REFNUM_QUAL) OB_LINE_REFNUMS, (SELECT listagg(INVOLVED_PARTY_QUAL_GID,',') within group (order by INVOLVED_PARTY_QUAL_GID) FROM INVOLVED_PARTY_QUAL) INVOLVED_PARTY, (SELECT listagg(ITEM_FEATURE_QUAL_GID,',') within group (order by ITEM_FEATURE_QUAL_GID) FROM ITEM_FEATURE_QUAL) lINE_ITEM_ATTRIBUTE from dual\n</Statement></Query></sql2xml>",exports.getTrackingEventPropfromOtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(SELECT listagg(SHIPMENT_REFNUM_QUAL_GID,',') within group (order by SHIPMENT_REFNUM_QUAL_GID) FROM SHIPMENT_REFNUM_QUAL) REFNUMS from dual\n</Statement></Query></sql2xml>",exports.getShipmentPropsfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(SHIPMENT_REFNUM_QUAL_GID,',') within group (order by SHIPMENT_REFNUM_QUAL_GID) FROM SHIPMENT_REFNUM_QUAL) SHIPMENT_REFNUMS from dual\n</Statement></Query></sql2xml>",exports.getTransmissionStatus=((_,E)=>`<sql2xml>\n    <Query>\n      <RootName>\n      TRANSACTION_STATUS\n      </RootName>\n      <Statement>\n        select OBJECT_GID\n          ,DATA_QUERY_TYPE_GID\n          ,I_TRANSACTION_NO\n          ,STATUS\n        from i_transaction\n        where ${E?"I_TRANSACTION_NO":"I_TRANSMISSION_NO"}\n          in ( ${_.join(",")} )\n      </Statement>\n    </Query>\n  </sql2xml>`);
},{}],"C6I7":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),r=new t.default.Schema({item:{type:"Number",default:0},party:{type:"Number",default:0},location:{type:"Number",default:0},"order-release":{type:"Number",default:0},"order-base":{type:"Number",default:0},bom:{type:"Number",default:0},transaction:{type:"Number",default:0},"tracking-event":{type:"Number",default:0},shipment:{type:"Number",default:0},user:{type:"String",required:!0},insertDate:{type:Date,default:Date.now}});exports.Report=(e=>t.default.model("Report",r,`Report_${e}`));
},{}],"IMRL":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("joi")),r=e(require("mongoose")),u=new r.default.Schema({url:{type:"String"},version:{type:"Number"},glogPerTrx:{type:"Number",default:10},item:{type:"Number",default:0},party:{type:"Number",default:0},location:{type:"Number",default:0},"order-release":{type:"Number",default:0},"order-base":{type:"Number",default:0},bom:{type:"Number",default:0},transaction:{type:"Number",default:0},"tracking-event":{type:"Number",default:0},shipment:{type:"Number",default:0}});function a(e){const r={glogPerTrx:{type:Number,required:!0}};return t.default.validate(e,r)}const l=e=>r.default.model("Setting",u,`Setting_${e}`);exports.Setting=l,exports.validate=a;
},{}],"oAdS":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("express")),s=e(require("multiparty")),r=e(require("node-xlsx")),a=require("../helper/other"),n=require("../api/gtm"),i=require("../helper/dbXmlQuery"),o=require("../api/gtm"),u=e(require("./../middleware/auth")),d=require("../models/report"),l=require("../models/setting"),c=t.default.Router();c.post("/",[u.default],a.asyncRouteHandler(async(e,t)=>{const{username:s,password:r,url:i}=e.user,{xml:o,xmlNs:u}=e.body;let d=o.toString();d=d.replace("<Transmission>",`<Transmission xmlns="${u[0]}" xmlns:otm="${u[0]}" xmlns:gtm="${u[1]}" >`);const{data:l,error:c}=await a.asyncHandler(n.wmServlet(i,d,s,r));if(c)return t.status(400).send(c);if(!l.includes("ReferenceTransmissionNo"))return t.status(400).send("Invalid csv Data");const m=l.match(/ReferenceTransmissionNo>(.*?)</)[1];return t.send({data:{ReferenceTransmissionNo:m}})})),c.post("/filedata",[u.default],a.asyncRouteHandler(async(e,t)=>{(new s.default.Form).parse(e,async function(e,s,a){const n=a[Object.keys(a)[0]][0].path,i=await r.default.parse(n,{raw:!0});return t.status(200).send({data:i[0].data})})})),c.post("/status",[u.default],a.asyncRouteHandler(async(e,t)=>{const{username:s,password:r,url:n}=e.user,{transmission:u,reProcess:c,xids:m,considerXid:p}=e.body;if(!u.length)return t.status(400).send("Bad request!");const T=i.getTransmissionStatus(u,c),{data:f,error:N}=await a.asyncHandler(o.dbXml(n,T,s,r));if(N)return t.status(400).send(N);const S=f.match(/TRANSACTION_STATUS(.*?)>/g),R=[];let h="";for(let i=0;i<S.length;i++){const e=S[i];h=e.match(/DATA_QUERY_TYPE_GID="(.*?)"/)[1].toLowerCase().replace("gtm","").replace("contact","party").trim().replace(" ","-");const t=e.match(/I_TRANSACTION_NO="(.*?)"/)[1],s=e.match(/OBJECT_GID="(.*?)"/)[1],r=e.match(/STATUS="(.*?)"/)[1];R.push({xid:p?m[i]:s.includes(".")?s.split(".")[1]:s,transmission:t,status:r,instanceURL:n+a.getReportUrl(t),viewURL:n+a.getViewUrl()})}if(!c){const e=Array.from(new Set(m)),t={$inc:{[h]:e.length}};await l.Setting(a.CONSTS.CURRENT_INSTANCE).findOneAndUpdate({version:+a.CONSTS.GTMVERSION},t,{new:!0}),await d.Report(a.CONSTS.CURRENT_INSTANCE).create({instance:a.CONSTS.CURRENT_INSTANCE,user:s,[h]:e.length})}return t.send({data:R})})),exports.default=c;
},{"../helper/other":"irtd","../api/gtm":"KJs0","../helper/dbXmlQuery":"bJb7","./../middleware/auth":"MNoc","../models/report":"C6I7","../models/setting":"IMRL"}],"Yp05":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),a=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]});exports.Release=((e,o)=>t.default.model("Release",a,`${e}_Release_${o}`));
},{}],"Ys6U":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),r=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},Release:{type:"Mixed"}});exports.SchemaRelease=t.default.model("SchemaRelease",r,"OrderReleaseSchema");
},{}],"jN2X":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("./other");exports.getElementName=(e=>{const r=e.replace(/(otm:|otm|gtm:|gtm)/gi,""),i=r.lastIndexOf("Gid"),n=r.substring(0,i-1).lastIndexOf(".")+1,o=r.substring(n,i-1),s=r.substring(r.lastIndexOf(".")+1),c=r.lastIndexOf("TransactionCode"),m=r.substring(0,c-1).lastIndexOf(".")+1,d=r.lastIndexOf("GtmItemCountryOfOrigin"),l=r.substring(0,d-1).lastIndexOf(".")+1,D=r.lastIndexOf("SequenceNumber"),L=r.substring(0,D-1).lastIndexOf(".")+1,h=r.lastIndexOf("Description"),u=r.substring(0,h-1).lastIndexOf(".")+1;let _=r.search("Xid")>-1?o:s;switch(_=_.replace(/(otm:|otm|gtm:|gtm)/gi,"").trim(),!0){case"DomainName"===_:_=r.substring(n,i-1)+_;break;case"TransactionCode"===_:_=r.substring(m,c-1).replace(/Header/g,"")+_;break;case"GtmItemCountryOfOrigin"===_:_="Suppliers"+r.substring(l,d-1)+_;break;case"SequenceNumber"===_:_=r.substring(L,D-1)+_;break;case"Description"===_:_=r.substring(u,h-1)+_;break;default:_=_.trim()}const N=(_=_.replace(/(otm:|otm|gtm:|gtm)/gi,"").trim()).match(/[A-Z][a-z]+|[0-9]+/g);return _=t(_=N&&N.length>1?N.join(" ").replace("Gid","ID"):_),a(_,e)}),exports.getMandatoryElement=((e,a=[])=>a.findIndex(a=>a===e)>-1),exports.getDefaultValue=((e,a)=>e.search("TransactionCode")>-1?"IU":e.search("DomainName")>-1?a:"");const a=(a,t)=>t.match(/GtmStructureComponent/)?`Bom Component ${a.replace(/(GtmStructure(.*?)Component)/gi,"").trim()}`:t.match(/GtmStructure(.*?)/)?a.replace(/(Structure)/g,"Bom").trim():t.match(/GtmContact(.*?)AddressLines(.*?)SequenceNumber/)?e.NAME.party.AddressLineSequenceNumber:t.match(/GtmContact(.*?)AddressLines(.*?)AddressLine/)?e.NAME.party.AddressLine:t.match(/Location(.*?)AddressLines(.*?)SequenceNumber/)?e.NAME.location.AddressLineSequenceNumber:t.match(/Location(.*?)AddressLines(.*?)AddressLine/)?e.NAME.location.AddressLine:t.match(/Release(.*?)ShipFromLocationRef(.*?)DomainName/)?e.NAME.release.Source_Location_Domain_Name:t.match(/Release(.*?)ShipFromLocationRef(.*?)Xid/)?e.NAME.release.Source_Location_ID:t.match(/Release(.*?)ShipToLocationRef(.*?)DomainName/)?e.NAME.release.Destination_Location_Domain_Name:t.match(/Release(.*?)ShipFromLocationRef(.*?)Xid/)?e.NAME.release.Source_Location_ID:t.match(/Release(.*?)ShipToLocationRef(.*?)Xid/)?e.NAME.release.Destination_Location_ID:t.match(/Release(.*?)ReleaseMethodGid(.*?)Xid/)?e.NAME.release.Order_Configuration:t.match(/Release(.*?)InitialItemGid(.*?)DomainName/)?e.NAME.release.Line_Item_Domain_Name:t.match(/Release(.*?)InitialItemGid(.*?)Xid/)?e.NAME.release.Line_Item_ID:t.match(/Release(.*?)ReleaseLine/)?`Line ${a.replace(/Release(.*?)Line/,"").trim()}`:t.match(/EarlyPickupDt(.*?)GLogDate/)?e.NAME.orderBase.Early_Pickup_Dt:t.match(/EarlyPickupDt(.*?)TZId/)?e.NAME.orderBase.Early_Pickup_TZID:t.match(/EarlyPickupDt(.*?)TZOffset/)?e.NAME.orderBase.Early_Pickup_TZOffset:t.match(/LatePickupDt(.*?)GLogDate/)?e.NAME.orderBase.Late_Pickup_Dt:t.match(/LatePickupDt(.*?)TZId/)?e.NAME.orderBase.Late_Pickup_TZID:t.match(/LatePickupDt(.*?)TZOffset/)?e.NAME.orderBase.Late_Pickup_TZOffset:t.match(/LateDeliveryDt(.*?)GLogDate/)?e.NAME.orderBase.Late_Delivery_Dt:t.match(/LateDeliveryDt(.*?)TZId/)?e.NAME.orderBase.Late_Delivery_TZID:t.match(/LateDeliveryDt(.*?)TZOffset/)?e.NAME.orderBase.Late_Delivery_TZOffset:t.match(/EarlyDeliveryDt(.*?)GLogDate/)?e.NAME.orderBase.Early_Delivery_Dt:t.match(/EarlyDeliveryDt(.*?)TZId/)?e.NAME.orderBase.Early_Delivery_TZID:t.match(/EarlyDeliveryDt(.*?)TZOffset/)?e.NAME.orderBase.Early_Delivery_TZOffset:t.match(/StartDt(.*?)GLogDate/)?e.NAME.shipment.StartDt:t.match(/EndDt(.*?)GLogDate/)?e.NAME.shipment.EndDt:t.match(/ArrivalTime(.*?)GLogDate/)?e.NAME.shipment.ArrivalTime:t.match(/TransOrder(.*?)ShipFromLocationRef(.*?)DomainName/)?e.NAME.orderBase.Source_Location_Domain_Name:t.match(/TransOrder(.*?)ShipFromLocationRef(.*?)Xid/)?e.NAME.orderBase.Source_Location_ID:t.match(/TransOrder(.*?)ShipToLocationRef(.*?)DomainName/)?e.NAME.orderBase.Destination_Location_Domain_Name:t.match(/TransOrder(.*?)ShipFromLocationRef(.*?)Xid/)?e.NAME.orderBase.Source_Location_ID:t.match(/TransOrder(.*?)ShipToLocationRef(.*?)Xid/)?e.NAME.orderBase.Destination_Location_ID:t.match(/TransOrder(.*?)ReleaseMethodGid(.*?)Xid/)?e.NAME.orderBase.Order_Configuration:t.match(/TransOrder(.*?)InitialItemGid(.*?)DomainName/)?e.NAME.orderBase.Line_Item_Domain_Name:t.match(/TransOrder(.*?)InitialItemGid(.*?)Xid/)?e.NAME.orderBase.Line_Item_ID:t.match(/TransOrderLine/)?`Line ${a.replace(/(Trans(.*?)Order(.*?)Line|Order(.*?)Line)/g,"").trim()}`:t.match(/TransOrder(.*?)TransOrderHeader/)?a.replace(/Trans(.*?)Order/g,"OrderBase").trim():t.match(/GtmTransactionLine/)?`Line ${a.replace(/(Transaction(.*?)Line)/gi,"").trim()}`:t.match(/GtmTransaction(.*?)/)?a.replace(/(Transaction)/g,"Transaction").trim():t.match(/LocationRefGid(.*?)DomainName/)?e.NAME.location.Location_ID_Domain_Name:t.match(/LocationRefGid(.*?)Xid/)?e.NAME.location.Location_ID:t.match(/LocationRefGid\.(.*?)/)&&!a.includes("LocationRef")?`Location ${a.trim()}`:t.match(/Contact(.*?)/)?a.replace(/(Party|Contact)/gi,"Party").trim():a;function t(e){return e.replace("Transaction Code","TransactionCode").replace("Domain Name","DomainName").replace("Service Provider","ServiceProvider").replace("User Defined","UserDefined").replace("Ship Unit","ShipUnit").replace("Packaged Item","PackagedItem")}
},{"./other":"irtd"}],"iG5u":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../other"),a=require("../renamer"),t=require("../other"),i=["Release ID DomainName","Release ID","Release TransactionCode","Line ID DomainName","Line ID","Line TransactionCode",...Object.values(t.NAME.release)],p=(a,t,i)=>{const p=e.capitalize(i.split("_").join(" "));return p.split(".")[1]?p.split(".")[1]:p},r=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};for(let l=0;l<e.getSequence.length;l++){e.getSequence[l]}exports.mapHeader=((e,t,p,r,l)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,i),display:a.getMandatoryElement(e.name,i),isMandatory:a.getMandatoryElement(e.name,i),type:t,displayText:e.name,defaultValue:a.getDefaultValue(e.path,l),path:[e.path],gtmVersion:p,xmlNs:r})),exports.mapRefnum=((t,i,l,n,s,m,o,d)=>{const u=r(i,"Xid"),h=r(i,"DomainName"),c=r(i,"RefnumValue"),D=r(i,"TransactionCode");return{name:`${o} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${o} ${p(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(i[c].path,d),path:[{path:i[c].path.replace("INDEX",m),value:""},e.getDomainName(t,i[h].path.replace("INDEX",m)),e.getTC(t,i[D].path.replace("INDEX",m)),e.getXID(t,i[u].path.replace("INDEX",m))],gtmVersion:n,xmlNs:s}}),exports.mapRemark=((t,i,l,n,s,m,o,d)=>{const u=r(i,"Xid"),h=r(i,"DomainName"),c=r(i,"RemarkText"),D=r(i,"RemarkSequence"),g=r(i,"TransactionCode");return{name:`${o} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${o} ${p(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(i[c].path,d),path:[{path:i[c].path.replace("INDEX",m),value:""},e.getTC(t,i[g].path.replace("INDEX",m)),e.getSequence(t,i[D].path.replace("INDEX",m),m),e.getDomainName(t,i[h].path.replace("INDEX",m)),e.getXID(t,i[u].path.replace("INDEX",m))],gtmVersion:n,xmlNs:s}}),exports.mapItemFeature=((t,i,l,n,s,m,o,d)=>{const u=r(i,"Xid"),h=r(i,"DomainName"),c=r(i,"ItemFeatureValue"),D=r(i,"TransactionCode");return{name:`${o} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${o} ${p(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(i[c].path,d),path:[{path:i[c].path,value:""},e.getDomainName(t,i[h].path),e.getTC(t,i[D].path),e.getXID(t,i[u].path)],gtmVersion:n,xmlNs:s}}),exports.mapItemClassification=((t,i,p,l,n,s,m)=>{const o=r(i,"Xid"),d=r(i,"ClassificationCode"),u=r(i,"TransactionCode");return{name:`${t} Classification`,required:!0,disabled:!1,display:!1,type:p,displayText:`${t} Classification`,defaultValue:a.getDefaultValue(i[d].path,m),path:[{path:i[d].path,value:""},e.getTC(t,i[u].path),e.getXID(t,i[o].path)],gtmVersion:l,xmlNs:n}}),exports.mapInvolvedParty=((t,i,l,n,s,m,o,d="")=>{const u=r(i,/InvolvedPartyQualifierGid(.*?)Xid/),h=r(i,/ContactGid(.*?)Xid/),c=r(i,/ContactGid(.*?)DomainName/),D=r(i,"TransactionCode");return{name:`${o} ${t} Contact ID`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${o} ${p(0,0,t)} Contact ID`.trim(),defaultValue:a.getDefaultValue(i[h].path,d),path:[{path:i[h].path,value:""},e.getTC(t,i[D].path),{path:i[c].path,value:d},e.getXID(t,i[u].path)],gtmVersion:n,xmlNs:s}}),exports.mapItemDescription=((t,i,p,l,n,s,m)=>{const o=r(i,"Xid"),d=r(i,"DomainName"),u=r(i,":Description"),h=r(i,"SequenceNumber"),c=r(i,"TransactionCode");return{name:`Description in ${t.split("::")[1]}`,required:!0,disabled:!1,display:!1,type:p,displayText:`Description in ${t.split("::")[1]}`,defaultValue:a.getDefaultValue(i[u].path,m),path:[{path:i[u].path,value:""},e.getTC(t.split("::")[0],i[c].path),e.getSequence(t.split("::")[0],i[h].path,s),e.getDomainName(t.split("::")[0],i[d].path),e.getXID(t.split("::")[0],i[o].path)],gtmVersion:l,xmlNs:n}});
},{"../other":"irtd","../renamer":"jN2X"}],"NFyl":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const a=e(require("lodash")),t=e(require("promise-memoize")),n=require("../../models/release"),r=require("../../models/schemaRelease"),m=require("./releaseProps");function s(e,t,n,r){return new Promise(function(s){let{Header:l,Remark:i,Refnum:o,InvolvedParty:R}=e.Release.Release,{Header:d,Remark:u,Refnum:p,InvolvedParty:f}=e.Release.ReleaseLine;const c=e.xmlNs;l=l.map(e=>m.mapHeader(e,"Release : Header",t,c,r)),d=d.map(e=>m.mapHeader(e,"Release Line : Header",t,c,r));const h=n.match(/REMARKS="(.*?)"/)[1].split(",");i=h.map((e,a)=>m.mapRemark(e,i,"Release : Remark",t,c,a,"",r)),u=h.map((e,a)=>m.mapRemark(e,u,"Release Line : Remark",t,c,a,"Line",r));const v=n.match(/INVOLVED_PARTY="(.*?)"/)[1].split(",");R=v.map((e,a)=>m.mapInvolvedParty(e,R,"Release : Involved Party",t,c,a,"",r)),f=v.map((e,a)=>m.mapInvolvedParty(e,f,"Release Line : Involved Party",t,c,a,"Line",r));const _=n.match(/RELEASE_REFNUMS="(.*?)"/)[1].split(",");o=_.map((e,a)=>m.mapRefnum(e,o,"Release : Refnum",t,c,a,"",r));const L=n.match(/RELEASE_LINE_REFNUMS="(.*?)"/)[1].split(",");p=L.map((e,a)=>m.mapRefnum(e,p,"Release Line : Refnum",t,c,a,"Line",r)),s(a.default.uniqBy([...l,...i,...o,...R,...d,...u,...p,...f],e=>e.name))})}function l(e,t,r,m){return new Promise(async function(s){const l=a.default.differenceWith(e,t,(e,a)=>e.name===a.name),i=a.default.differenceWith(t,e,(e,a)=>e.name===a.name);if(l.length>0){const e=await n.Release(m,r).insertMany(l);s([...t,...e])}else i.length>0?(await n.Release(m,r).deleteMany({_id:{$in:[...i.map(e=>e._id)]}}),s(a.default.differenceWith(t,i,(e,a)=>e.name===a.name))):s(t)})}function i(e){return r.SchemaRelease.findOne({gtmVersion:e}).sort({_id:1})}exports.getReleaseSchema=t.default(i,{maxAge:6e4}),exports.getReleaseData=t.default(s,{maxAge:6e4}),exports.getUpdatedProp=t.default(l,{maxAge:6e4});
},{"../../models/release":"Yp05","../../models/schemaRelease":"Ys6U","./releaseProps":"iG5u"}],"aCHs":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("express")),a=t.default.Router(),s=require("../helper/other"),r=require("../helper/dbXmlQuery"),n=require("../helper/Release/getReleaseData"),i=require("../api/gtm"),u=require("../models/release"),l=e(require("../middleware/auth"));function d(e){return e.query.gtmVersion?+e.query.gtmVersion:+s.CONSTS.GTMVERSION}a.get("/",[l.default],s.asyncRouteHandler(async(e,t)=>{const{display:a}=e.query,{username:l,password:o,instance:p,url:c}=e.user,f=l.split(".")[0];if(a){const e=await u.Release(f,p).find({display:a}).sort({_id:1});if(e.length)return t.status(200).json({data:e})}const m=d(e),y=await n.getReleaseSchema(m);if(!y)return t.status(400).send(`gtmVersion:${m} schema not available!`);const{data:R,error:g}=await s.asyncHandler(i.dbXml(c,r.getReleasePropsfromGtm,l,o));if(g)return t.status(400).send(g);const h=await n.getReleaseData(y,m,R,f);let w=await u.Release(f,p).find({}).sort({_id:1});return w&&0!==w.length?(w=await n.getUpdatedProp(h,w,p,f),a?t.status(200).json({data:w.filter(e=>e.display)}):t.status(200).json({data:w})):t.status(200).json({data:await u.Release(f,p).insertMany(h)})})),a.put("/",[l.default],s.asyncRouteHandler(async(e,t)=>{let{release:a}=e.body;const{username:s,instance:r}=e.user,n=s.split(".")[0];return a?(a=await u.Release(n,r).findByIdAndUpdate(a._id,a,{new:!0}),t.status(200).json({data:a})):t.status(400).send("Release prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Release/getReleaseData":"NFyl","../api/gtm":"KJs0","../models/release":"Yp05","../middleware/auth":"MNoc"}],"mbXe":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("winston"));function s(e,s,r,u){t.default.error(e.message,e),r.status(500).send("Something failed.")}exports.default=s;
},{}],"XNdw":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../renamer"),a=e(require("lodash")),r=require("../other"),n=e=>{const t={};return a.default.keys(e).map(e=>m(e,t)).filter(e=>void 0!==e),t},m=(e,t)=>{switch(!0){case-1!==e.search("Remark"):c(e,t,"Remark");break;case-1!==e.search("ItemFeature"):c(e,t,"ItemFeature");break;case-1!==e.search("GtmItemClassification"):c(e,t,"GtmItemClassification");break;case-1!==e.search("GtmItemDescription"):c(e,t,"GtmItemDescription");break;case-1!==e.search("GtmItemCountryOfOrigin"):c(e,t,"GtmItemCountryOfOrigin");break;case-1!==e.search("GtmItemUomConversion"):c(e,t,"GtmItemUomConversion");break;case-1!==e.search("Refnum"):c(e,t,"Refnum");break;case-1!==e.search("PricePerUnit"):c(e,t,"PricePerUnit");break;default:c(e,t,"Header")}return t};exports.getChilds=(e=>{const t={Item:{},Packaging:{}};return a.default.keys(e).map(a=>{switch(!0){case-1===a.search("ItemMaster"):break;case-1!==a.search("Packaging"):s(a,e,t,"Packaging");break;default:s(a,e,t,"Item")}return t}).filter(e=>void 0!==e),t.Item=n(t.Item),t.Packaging=n(t.Packaging),{ItemMaster:t}});const s=(e,t,a,r)=>{a[`${r}`][`${e}`]=t[`${e}`]},c=(e,n,m)=>{let s=e,c=e;switch(!0){case"Remark"===m:s=r.convertPath(e,"Remark").newPath,c=r.convertPath(e,"Remark").newName;break;case"Refnum"===m:s=r.convertPath(e,"Refnum").newPath,c=r.convertPath(e,"Refnum").newName;break;case"ItemFeature"===m:s=r.convertPath(e,"ItemFeature").newPath,c=r.convertPath(e,"ItemFeature").newName;break;case"GtmItemClassification"===m:s=r.convertPath(e,"GtmItemClassification").newPath,c=r.convertPath(e,"GtmItemClassification").newName;break;case"GtmItemDescription"===m:s=r.convertPath(e,"GtmItemDescription").newPath,c=r.convertPath(e,"GtmItemDescription").newName;break;case"GtmItemCountryOfOrigin"===m:s=r.convertPath(e,"GtmItemCountryOfOrigin").newPath,c=r.convertPath(e,"GtmItemCountryOfOrigin").newName;break;case"GtmItemUomConversion"===m:s=r.convertPath(e,"GtmItemUomConversion").newPath,c=r.convertPath(e,"GtmItemUomConversion").newName}n[`${m}`]||(n[`${m}`]=[]),n[`${m}`].push({name:t.getElementName(c),path:s}),n[`${m}`]=a.default.uniqBy(n[`${m}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"iDDx":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),r=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},ItemMaster:{type:"Mixed"}});exports.SchemaItem=t.default.model("SchemaItem",r,"ItemSchema");
},{}],"RPHv":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./../index"),s=e(require("express")),a=s.default.Router(),r=e(require("path")),n=e(require("fast-xml-parser")),i=e(require("flat")),m=require("../helper/other"),o=require("../helper/Item/schemaItemProps"),u=require("../models/schemaItem");async function l(){const e=r.default.join(t.ROOT_DIR,"XMLs","Item.xml"),s=await m.getFileData(e),a=n.default.getTraversalObj(s,{}),l=n.default.convertToJson(a,{}),d=i.default(l),c=o.getChilds(d);let{gtmVersion:f,xmlNsOtm:g,xmlNsGtm:h}=m.getXMlVersion(s);return f||(f=Number(m.CONSTS.GTMVERSION)),new u.SchemaItem({xmlNs:[g,h],gtmVersion:f,...c}).save()}a.post("/",m.asyncRouteHandler(async(e,s)=>{const a=r.default.join(t.ROOT_DIR,"XMLs","Item.xml"),l=await m.getFileData(a),d=n.default.getTraversalObj(l,{}),c=n.default.convertToJson(d,{}),f=i.default(c),g=o.getChilds(f),{gtmVersion:h,xmlNsOtm:I,xmlNsGtm:O}=m.getXMlVersion(l);if(!h)return s.status(400).send("XML must contain Namespace");let x=await u.SchemaItem.findOne({gtmVersion:h});if(x){if(JSON.stringify(x.ItemMaster)===JSON.stringify(g.ItemMaster))return s.status(200).send(x);await u.SchemaItem.findByIdAndRemove(x._id)}return x=new u.SchemaItem({xmlNs:[I,O],gtmVersion:h,...g}),x=await x.save(),s.status(200).send(x)})),a.get("/",m.asyncRouteHandler(async(e,t)=>{const{gtmVersion:s}=e.query;if(!s){const e=await u.SchemaItem.find().sort({gtmVersion:-1});return t.status(200).send(e)}const a=await u.SchemaItem.findOne({gtmVersion:s});return a?t.status(200).send(a):t.status(400).send(`gtmVersion:${s} schema not available!`)})),exports.default=a,exports.generateItemSchema=l;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Item/schemaItemProps":"XNdw","../models/schemaItem":"iDDx"}],"I17b":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const a=require("../renamer"),t=e(require("lodash")),r=require("../other"),s=e=>{const a={};return t.default.keys(e).map(e=>n(e,a)).filter(e=>void 0!==e),a},n=(e,a)=>{switch(!0){case-1!==e.search("InvolvedParty"):l(e,a,"InvolvedParty");break;case-1!==e.search("Remark"):l(e,a,"Remark");break;case-1!==e.search("ItemAttributes"):l(e,a,"ItemAttributes");break;case-1!==e.search("Refnum"):l(e,a,"Refnum");break;case-1!==e.search("PricePerUnit"):l(e,a,"PricePerUnit");break;default:l(e,a,"Header")}return a};exports.getChilds=(e=>{const a={Release:{},ReleaseLine:{}};return t.default.keys(e).map(t=>{switch(!0){case-1===t.search("Release")||t.search("ReleaseStatus")>-1:break;case-1!==t.search("ReleaseLine"):c(t,e,a,"ReleaseLine");break;default:c(t,e,a,"Release")}return a}).filter(e=>void 0!==e),a.Release=s(a.Release),a.ReleaseLine=s(a.ReleaseLine),{Release:a}});const c=(e,a,t,r)=>{t[`${r}`][`${e}`]=a[`${e}`]},l=(e,s,n)=>{let c=e,l=e;switch(!0){case"Remark"===n:c=r.convertPath(e,"Remark").newPath,l=r.convertPath(e,"Remark").newName;break;case"InvolvedParty"===n:c=r.convertPath(e,"InvolvedParty").newPath,l=r.convertPath(e,"InvolvedParty").newName;break;case"Refnum"===n:c=r.convertPath(e,"Refnum").newPath,l=r.convertPath(e,"Refnum").newName;break;case"ItemAttributes"===n:c=r.convertPath(e,"ItemAttributes").newPath,l=r.convertPath(e,"ItemAttributes").newName}s[`${n}`]||(s[`${n}`]=[]),s[`${n}`].push({name:a.getElementName(l),path:c}),s[`${n}`]=t.default.uniqBy(s[`${n}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"woBX":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./../index"),s=e(require("express")),a=s.default.Router(),r=e(require("path")),n=e(require("fast-xml-parser")),i=e(require("flat")),l=require("../helper/other"),u=require("../helper/Release/schemaReleaseProps"),o=require("../models/schemaRelease");a.post("/",l.asyncRouteHandler(async(e,s)=>{const a=r.default.join(t.ROOT_DIR,"XMLs","OrderRelease.xml"),d=await l.getFileData(a),m=n.default.getTraversalObj(d,{}),c=n.default.convertToJson(m,{}),f=i.default(c),R=u.getChilds(f),{gtmVersion:h,xmlNsOtm:g,xmlNsGtm:p}=l.getXMlVersion(d);if(!h)return s.status(400).send("XML must contain Namespace");let O=await o.SchemaRelease.findOne({gtmVersion:h});if(O){if(JSON.stringify(O.Release)===JSON.stringify(R.Release))return s.status(200).send(O);await o.SchemaRelease.findByIdAndRemove(O._id)}return O=new o.SchemaRelease({xmlNs:[g,p],gtmVersion:h,...R}),O=await O.save(),s.status(200).send(O)})),a.get("/",l.asyncRouteHandler(async(e,t)=>{const{gtmVersion:s}=e.query;if(!s){const e=await o.SchemaRelease.find().sort({gtmVersion:-1});return t.status(200).send(e)}const a=await o.SchemaRelease.findOne({gtmVersion:s});return a?t.status(200).send(a):t.status(400).send(`gtmVersion:${s} schema not available!`)})),exports.default=a;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Release/schemaReleaseProps":"I17b","../models/schemaRelease":"Ys6U"}],"z2rt":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),o=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]});exports.Item=((e,r)=>t.default.model("Item",o,`${e}_Item_${r}`));
},{}],"OaWk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../other"),a=require("../renamer"),t=["Item TransactionCode","Item ID DomainName","Item ID"],p=(a,t,p)=>{const i=e.capitalize(p.split("_").join(" "));return i.split(".")[1]?i.split(".")[1]:i},i=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};for(let l=0;l<e.getSequence.length;l++){e.getSequence[l]}exports.mapHeader=((e,p,i,l,n)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,t),display:a.getMandatoryElement(e.name,t),isMandatory:a.getMandatoryElement(e.name,t),type:p,displayText:e.name,defaultValue:a.getDefaultValue(e.path,n),path:[e.path],gtmVersion:i,xmlNs:l})),exports.mapRefnum=((t,l,n,r,s,m,u)=>{const o=i(l,"Xid"),d=i(l,"DomainName"),h=i(l,"RefnumValue"),c=i(l,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:n,displayText:p(0,0,t),defaultValue:a.getDefaultValue(l[h].path,u),path:[{path:l[h].path.replace("INDEX",m),value:""},e.getDomainName(t,l[d].path.replace("INDEX",m)),e.getTC(t,l[c].path.replace("INDEX",m)),e.getXID(t,l[o].path.replace("INDEX",m))],gtmVersion:r,xmlNs:s}}),exports.mapItemFeature=((t,l,n,r,s,m,u)=>{const o=i(l,"Xid"),d=i(l,"DomainName"),h=i(l,"ItemFeatureValue"),c=i(l,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:n,displayText:p(0,0,t),defaultValue:a.getDefaultValue(l[h].path,u),path:[{path:l[h].path,value:""},e.getDomainName(t,l[d].path),e.getTC(t,l[c].path),e.getXID(t,l[o].path)],gtmVersion:r,xmlNs:s}}),exports.mapItemClassification=((t,p,l,n,r,s,m)=>{const u=i(p,"Xid"),o=i(p,"ClassificationCode"),d=i(p,"TransactionCode");return{name:`${t} Classification`,required:!0,disabled:!1,display:!1,type:l,displayText:`${t} Classification`,defaultValue:a.getDefaultValue(p[o].path,m),path:[{path:p[o].path,value:""},e.getTC(t,p[d].path),e.getXID(t,p[u].path)],gtmVersion:n,xmlNs:r}}),exports.mapRemark=((t,l,n,r,s,m,u)=>{const o=i(l,"Xid"),d=i(l,"DomainName"),h=i(l,"RemarkText"),c=i(l,"RemarkSequence"),D=i(l,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:n,displayText:p(0,0,t),defaultValue:a.getDefaultValue(l[h].path,u),path:[{path:l[h].path.replace("INDEX",m),value:""},e.getTC(t,l[D].path.replace("INDEX",m)),e.getSequence(t,l[c].path.replace("INDEX",m),m),e.getDomainName(t,l[d].path.replace("INDEX",m)),e.getXID(t,l[o].path.replace("INDEX",m))],gtmVersion:r,xmlNs:s}}),exports.mapItemDescription=((t,p,l,n,r,s,m)=>{const u=i(p,"Xid"),o=i(p,"DomainName"),d=i(p,":Description"),h=i(p,"SequenceNumber"),c=i(p,"TransactionCode");return{name:`Description in ${t.split("::")[1]}`,required:!0,disabled:!1,display:!1,type:l,displayText:`Description in ${t.split("::")[1]}`,defaultValue:a.getDefaultValue(p[d].path,m),path:[{path:p[d].path,value:""},e.getTC(t.split("::")[0],p[c].path),e.getSequence(t.split("::")[0],p[h].path,s),e.getDomainName(t.split("::")[0],p[o].path),e.getXID(t.split("::")[0],p[u].path)],gtmVersion:n,xmlNs:r}});
},{"../other":"irtd","../renamer":"jN2X"}],"UQUS":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("lodash")),n=e(require("promise-memoize")),m=require("../../models/item"),a=require("../../models/schemaItem"),r=require("./itemProps");function i(e,n,m,a){return new Promise(function(r){let{Header:i,Remark:c,Refnum:f,GtmItemClassification:h,GtmItemDescription:M,ItemFeature:R}=e.ItemMaster.Item;const S=e.xmlNs;i=d(i,n,S,a),c=I(m,c,n,S,a),f=l(m,f,n,S,a),R=p(m,R,n,S,a),h=s(m,h,n,S,a),M=o(m,M,n,S,a),r(t.default.uniqBy([...i,...c,...f,...R,...h,...M],u()))})}function u(){return e=>e.name}function o(e,t,n,m,a){return t=e.match(/GTMITEMDESCRIPTIONS="(.*?)"/)[1].split(",").map(c(t,n,m,a))}function s(e,t,n,m,a){return t=e.match(/GTMITEMCLASSIFICATIONS="(.*?)"/)[1].split(",").map(f(t,n,m,a))}function c(e,t,n,m){return(a,i)=>r.mapItemDescription(a,e,"Item : Description",t,n,i,m)}function f(e,t,n,m){return(a,i)=>r.mapItemClassification(a,e,"Item : Classification",t,n,i,m)}function p(e,t,n,m,a){const i=e.match(/ITEMFEATURES="(.*?)"/)[1].split(",");return t=i.map((e,i)=>r.mapItemFeature(e,t,"Item : Feature",n,m,i,a))}function l(e,t,n,m,a){const i=e.match(/REFNUMS="(.*?)"/)[1].split(",");return t=i.map((e,i)=>r.mapRefnum(e,t,"Item : Refnum",n,m,i,a))}function I(e,t,n,m,a){const i=e.match(/REMARKS="(.*?)"/)[1].split(",");return t=i.map((e,i)=>r.mapRemark(e,t,"Item : Remark",n,m,i,a))}function d(e,t,n,m){return e=e.map(e=>r.mapHeader(e,"Item : Header",t,n,m))}function h(e,n,a,r){return new Promise(async function(i){const u=t.default.differenceWith(e,n,(e,t)=>e.name===t.name),o=t.default.differenceWith(n,e,(e,t)=>e.name===t.name);if(u.length>0){const e=await m.Item(r,a).insertMany(u);i([...n,...e])}else o.length>0?(await m.Item(r,a).deleteMany({_id:{$in:[...o.map(e=>e._id)]}}),i(t.default.differenceWith(n,o,(e,t)=>e.name===t.name))):i(n)})}function M(e){return a.SchemaItem.findOne({gtmVersion:e}).sort({_id:1})}exports.getItemSchema=n.default(M,{maxAge:6e4}),exports.getItemData=n.default(i,{maxAge:6e4}),exports.getUpdatedProp=n.default(h,{maxAge:6e4});
},{"../../models/item":"z2rt","../../models/schemaItem":"iDDx","./itemProps":"OaWk"}],"o5f2":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("express")),a=e.default.Router(),r=require("../helper/other"),n=require("../helper/dbXmlQuery"),s=require("../helper/Item/getItemData"),u=require("../api/gtm"),i=require("../models/item"),o=t(require("../middleware/auth")),d=require("./schemaItem");async function c(t,e,a){return await i.Item(t,e).find({display:a}).sort({_id:1})}async function l(t,e,a){return t=await i.Item(e,a).findByIdAndUpdate(t._id,t,{new:!0})}async function m(t,e){return await i.Item(t,e).find({}).sort({_id:1})}function f(t){return{data:t.filter(t=>t.display)}}async function p(t,e,a){return{data:await i.Item(t,e).insertMany(a)}}function y(t){return!t||0===t.length}function w(t){return t.split(".")[0]}function I(t){return t.query.gtmVersion?+t.query.gtmVersion:+r.CONSTS.GTMVERSION}a.get("/",[o.default],r.asyncRouteHandler(async(t,e)=>{const{display:a}=t.query,{username:i,password:o,instance:l,url:g}=t.user,h=w(i);if(a){const t=await c(h,l,a);if(t.length)return e.status(200).json({data:t})}const q=I(t);let _=await s.getItemSchema(q);_||(_=await d.generateItemSchema());const{data:j,error:S}=await r.asyncHandler(u.dbXml(g,n.getItemPropfromGtm,i,o));if(S)return e.status(400).send(S);const b=await s.getItemData(_,q,j,h);let M=await m(h,l);return y(M)?e.status(200).json(await p(h,l,b)):(M=await s.getUpdatedProp(b,M,l,h),a?e.status(200).json(f(M)):e.status(200).json({data:M}))})),a.put("/",[o.default],r.asyncRouteHandler(async(t,e)=>{const{instance:a,username:r}=t.user,n=w(r);let{item:s}=t.body;return s?(s=await l(s,n,a),e.status(200).json({data:s})):e.status(400).send("Item prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Item/getItemData":"UQUS","../api/gtm":"KJs0","../models/item":"z2rt","../middleware/auth":"MNoc","./schemaItem":"RPHv"}],"Yjam":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),o=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]});exports.Location=((e,a)=>t.default.model("Location",o,`${e}_Location_${a}`));
},{}],"EPD9":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),o=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},Location:{type:"Mixed"}});exports.SchemaLocation=t.default.model("SchemaLocation",o,"LocationSchema");
},{}],"Dqth":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../other"),a=require("../renamer"),t=["Location TransactionCode","Location ID DomainName","Location ID","Party ID DomainName","Party ID","Party TransactionCode"],r=(a,t,r)=>{const p=e.capitalize(r.split("_").join(" "));return p.split(".")[1]?p.split(".")[1]:p},p=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};for(let n=0;n<e.getSequence.length;n++){e.getSequence[n]}exports.mapHeader=((e,r,p,n,l)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,t),display:a.getMandatoryElement(e.name,t),type:r,displayText:e.name,defaultValue:a.getDefaultValue(e.path,l),path:[e.path],gtmVersion:p,xmlNs:n})),exports.mapRefnum=((t,n,l,i,m,s,o)=>{const d=p(n,"Xid"),u=p(n,"DomainName"),c=p(n,"RefnumValue"),h=p(n,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:l,displayText:r(0,0,t),defaultValue:a.getDefaultValue(n[c].path,o),path:[{path:n[c].path.replace("INDEX",s),value:""},e.getDomainName(t,n[u].path.replace("INDEX",s)),e.getTC(t,n[h].path.replace("INDEX",s)),e.getXID(t,n[d].path.replace("INDEX",s))],gtmVersion:i,xmlNs:m}}),exports.mapRemark=((t,n,l,i,m,s,o)=>{const d=p(n,"Xid"),u=p(n,"DomainName"),c=p(n,"RemarkText"),h=p(n,"RemarkSequence"),D=p(n,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:l,displayText:r(0,0,t),defaultValue:a.getDefaultValue(n[c].path,o),path:[{path:n[c].path.replace("INDEX",s),value:""},e.getTC(t,n[D].path.replace("INDEX",s)),e.getSequence(t,n[h].path.replace("INDEX",s),s),e.getDomainName(t,n[u].path.replace("INDEX",s)),e.getXID(t,n[d].path.replace("INDEX",s))],gtmVersion:i,xmlNs:m}}),exports.mapAddressLine=((a,t,p,n,l,i,m,s)=>{return{name:`${m} ${a}`.trim(),required:!0,disabled:!1,display:!1,type:p,displayText:`${m} ${r(0,0,a)}`.trim(),defaultValue:"",path:[{path:t[1].path.replace("INDEX",i),value:""},e.getSequence(a,t[0].path.replace("INDEX",i),i)],gtmVersion:n,xmlNs:l}});
},{"../other":"irtd","../renamer":"jN2X"}],"wmMx":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const a=e(require("lodash")),t=e(require("promise-memoize")),n=require("../../models/location"),o=require("../../models/schemaLocation"),i=require("./locationProps");function r(e,t,n,o){return new Promise(function(r){let{Header:m,Remark:d,Refnum:c}=e.Location,{AddressLines:s}=e.Location,{Header:u}=e.Location.Contact,{Header:f}=e.Location.ServiceProvider;const l=e.xmlNs;m=m.map(e=>i.mapHeader(e,"Location : Header",t,l,o)),u=u.map(e=>i.mapHeader(e,"Party : Header",t,l,o)),f=f.map(e=>i.mapHeader(e,"ServiceProvider : Header",t,l,o));const p=n.match(/REMARKS="(.*?)"/)[1].split(",");d=p.map((e,a)=>i.mapRemark(e,d,"Location : Remark",t,l,a,o));const L=n.match(/REFNUMS="(.*?)"/)[1].split(",");c=L.map((e,a)=>i.mapRefnum(e,c,"Location : Refnum",t,l,a,o)),s=[1,2,3].map(e=>i.mapAddressLine(`Address Line ${e}`,s,"Location : Address Line",t,l,e-1,"",o)),r(a.default.uniqBy([...m,...d,...c,...s,...u,...f],e=>e.name))})}function m(e,t,o,i){return new Promise(async function(r){const m=a.default.differenceWith(e,t,(e,a)=>e.name===a.name),d=a.default.differenceWith(t,e,(e,a)=>e.name===a.name);if(m.length>0){const e=await n.Location(i,o).insertMany(m);r([...t,...e])}else d.length>0?(await n.Location(i,o).deleteMany({_id:{$in:[...d.map(e=>e._id)]}}),r(a.default.differenceWith(t,d,(e,a)=>e.name===a.name))):r(t)})}function d(e){return o.SchemaLocation.findOne({gtmVersion:e}).sort({_id:1})}exports.getLocationSchema=t.default(d,{maxAge:6e4}),exports.getLocationData=t.default(r,{maxAge:6e4}),exports.getUpdatedProp=t.default(m,{maxAge:6e4});
},{"../../models/location":"Yjam","../../models/schemaLocation":"EPD9","./locationProps":"Dqth"}],"pk3O":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("express")),a=e.default.Router(),r=require("../helper/other"),s=require("../helper/dbXmlQuery"),n=require("../helper/Location/getLocationData"),o=require("../api/gtm"),i=require("../models/location"),u=t(require("../middleware/auth"));function d(t){return t.query.gtmVersion?+t.query.gtmVersion:+r.CONSTS.GTMVERSION}a.get("/",[u.default],r.asyncRouteHandler(async(t,e)=>{const{display:a}=t.query,{username:u,password:l,instance:c,url:p}=t.user,f=u.split(".")[0];if(a){const t=await i.Location(f,c).find({display:a}).sort({_id:1});if(t.length)return e.status(200).json({data:t})}const m=d(t),y=await n.getLocationSchema(m);if(!y)return e.status(400).send(`gtmVersion:${m} schema not available!`);const{data:g,error:h}=await r.asyncHandler(o.dbXml(p,s.getLocationPropfromOtm,u,l));if(h)return e.status(400).send(h);const w=await n.getLocationData(y,m,g,f);let q=await i.Location(f,c).find({}).sort({_id:1});return q&&0!==q.length?(q=await n.getUpdatedProp(w,q,c,f),a?e.status(200).json({data:q.filter(t=>t.display)}):e.status(200).json({data:q})):e.status(200).json({data:await i.Location(f,c).insertMany(w)})})),a.put("/",[u.default],r.asyncRouteHandler(async(t,e)=>{let{location:a}=t.body;const{username:r,instance:s}=t.user,n=r.split(".")[0];return a?(a=await i.Location(n,s).findByIdAndUpdate(a._id,a,{new:!0}),e.status(200).json({data:a})):e.status(400).send("Location prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Location/getLocationData":"wmMx","../api/gtm":"KJs0","../models/location":"Yjam","../middleware/auth":"MNoc"}],"bvcS":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("../renamer"),t=e(require("lodash")),a=require("../other"),s=e=>{const r={};return t.default.keys(e).map(e=>n(e,r)).filter(e=>void 0!==e),r},n=(e,r)=>{switch(!0){case-1!==e.search("Remark"):o(e,r,"Remark");break;case-1!==e.search("Refnum"):o(e,r,"Refnum");break;case-1!==e.search("AddressLines"):o(e,r,"AddressLines");break;default:o(e,r,"Header")}return r};exports.getChilds=(e=>{const r={Locations:{},Contact:{},ServiceProvider:{}};return t.default.keys(e).map(t=>{switch(!0){case-1===t.search("Location"):break;case-1!==t.search("Contact"):c(t,e,r,"Contact");break;case-1!==t.search("ServiceProvider"):c(t,e,r,"ServiceProvider");break;default:c(t,e,r,"Locations")}return r}).filter(e=>void 0!==e),r.Locations=s(r.Locations),r.Contact=s(r.Contact),r.ServiceProvider=s(r.ServiceProvider),r.Locations.Contact={...r.Contact},r.Locations.ServiceProvider={...r.ServiceProvider},{Location:r.Locations}});const c=(e,r,t,a)=>{t[`${a}`][`${e}`]=r[`${e}`]},o=(e,s,n)=>{let c=e,o=e;switch(!0){case"Remark"===n:c=a.convertPath(e,"Remark").newPath,o=a.convertPath(e,"Remark").newName;break;case"Refnum"===n:c=a.convertPath(e,"Refnum").newPath,o=a.convertPath(e,"Refnum").newName;break;case"AddressLines"===n:c=a.convertPath(e,"AddressLines").newPath,o=a.convertPath(e,"AddressLines").newName}s[`${n}`]||(s[`${n}`]=[]),s[`${n}`].push({name:r.getElementName(o),path:c}),s[`${n}`]=t.default.uniqBy(s[`${n}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"ZmvT":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./../index"),a=e(require("express")),s=a.default.Router(),n=e(require("path")),r=e(require("fast-xml-parser")),i=e(require("flat")),o=require("../helper/other"),u=require("../helper/Location/schemaLocationProps"),c=require("../models/schemaLocation");s.post("/",o.asyncRouteHandler(async(e,a)=>{const s=n.default.join(t.ROOT_DIR,"XMLs","Location.xml"),l=await o.getFileData(s),d=r.default.getTraversalObj(l,{}),m=r.default.convertToJson(d,{}),f=i.default(m),h=u.getChilds(f),{gtmVersion:g,xmlNsOtm:L,xmlNsGtm:p}=o.getXMlVersion(l);if(!g)return a.status(400).send("XML must contain Namespace");let q=await c.SchemaLocation.findOne({gtmVersion:g});if(q){if(JSON.stringify(q.Location)===JSON.stringify(h.Location))return a.status(200).send(q);await c.SchemaLocation.findByIdAndRemove(q._id)}return q=new c.SchemaLocation({xmlNs:[L,p],gtmVersion:g,...h}),q=await q.save(),a.status(200).send(q)})),s.get("/",o.asyncRouteHandler(async(e,t)=>{const{gtmVersion:a}=e.query;if(!a){const e=await c.SchemaLocation.find().sort({gtmVersion:-1});return t.status(200).send(e)}const s=await c.SchemaLocation.findOne({gtmVersion:a});return s?t.status(200).send(s):t.status(400).send(`gtmVersion:${a} schema not available!`)})),exports.default=s;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Location/schemaLocationProps":"bvcS","../models/schemaLocation":"EPD9"}],"Ovyc":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),r=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]});exports.Party=((e,a)=>t.default.model("Party",r,`${e}_Party_${a}`));
},{}],"axFa":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),r=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},GtmContact:{type:"Mixed"}});exports.SchemaParty=t.default.model("SchemaParty",r,"PartySchema");
},{}],"Bhcp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../other"),a=require("../renamer"),t=require("../other"),r=["Party TransactionCode","Party ID DomainName","Party ID",...Object.values(t.NAME.party)],p=(a,t,r)=>{const p=e.capitalize(r.split("_").join(" "));return p.split(".")[1]?p.split(".")[1]:p},l=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};for(let n=0;n<e.getSequence.length;n++){e.getSequence[n]}exports.mapHeader=((e,t,p,l,n)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,r),display:a.getMandatoryElement(e.name,r),isMandatory:a.getMandatoryElement(e.name,r),type:t,displayText:e.name,defaultValue:a.getDefaultValue(e.path,n),path:[e.path],gtmVersion:p,xmlNs:l})),exports.mapRefnum=((t,r,n,i,m,s,u,d)=>{const o=l(r,"Xid"),c=l(r,"DomainName"),h=l(r,"RefnumValue"),D=l(r,"TransactionCode");return{name:`${u} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${u} ${p(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(r[h].path,d),path:[{path:r[h].path.replace("INDEX",s),value:""},e.getDomainName(t,r[c].path.replace("INDEX",s)),e.getTC(t,r[D].path.replace("INDEX",s)),e.getXID(t,r[o].path.replace("INDEX",s))],gtmVersion:i,xmlNs:m}}),exports.mapRemark=((t,r,n,i,m,s,u,d)=>{const o=l(r,"Xid"),c=l(r,"DomainName"),h=l(r,"RemarkText"),D=l(r,"RemarkSequence"),g=l(r,"TransactionCode");return{name:`${u} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${u} ${p(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(r[h].path,d),path:[{path:r[h].path.replace("INDEX",s),value:""},e.getTC(t,r[g].path.replace("INDEX",s)),e.getSequence(t,r[D].path.replace("INDEX",s),s),e.getDomainName(t,r[c].path.replace("INDEX",s)),e.getXID(t,r[o].path.replace("INDEX",s))],gtmVersion:i,xmlNs:m}}),exports.mapAddressLine=((a,t,r,l,n,i,m,s)=>{return{name:`${m} ${a}`.trim(),required:!0,disabled:!1,display:!1,type:r,displayText:`${m} ${p(0,0,a)}`.trim(),defaultValue:"",path:[{path:t[1].path.replace("INDEX",i),value:""},e.getSequence(a,t[0].path.replace("INDEX",i),i)],gtmVersion:l,xmlNs:n}});
},{"../other":"irtd","../renamer":"jN2X"}],"dEF4":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("lodash")),n=e(require("promise-memoize")),r=require("../../models/party"),a=require("../../models/schemaParty"),i=require("./partyProps");function u(e,n,r,a){return new Promise(function(i){let{Header:u,Remark:s,Refnum:p}=e.GtmContact.Contact,{Header:l}=e.GtmContact.LocationRef,{AddressLines:P}=e.GtmContact.LocationRef;const y=e.xmlNs;({PHeader:u,PLocRef:l}=c(u,n,y,a,l)),s=f(r,s,n,y,a),p=m(r,p,n,y,a),P=o(P,n,y,a),i(t.default.uniqBy([...u,...s,...p,...l,...P],d()))})}function o(e,t,n,r){return e=[1,2,3].map(s(e,t,n,r))}function m(e,t,n,r,a){return t=e.match(/REFNUMS="(.*?)"/)[1].split(",").map(p(t,n,r,a))}function f(e,t,n,r,a){return t=e.match(/REMARKS="(.*?)"/)[1].split(",").map(l(t,n,r,a))}function c(e,t,n,r,a){return{PHeader:e=e.map(y(t,n,r)),PLocRef:a=a.map(P(t,n,r))}}function d(){return e=>e.name}function s(e,t,n,r){return a=>i.mapAddressLine(`Address Line ${a}`,e,"Party : Address Line",t,n,a-1,"",r)}function p(e,t,n,r){return(a,u)=>i.mapRefnum(a,e,"Party : Refnum",t,n,u,"",r)}function l(e,t,n,r){return(a,u)=>i.mapRemark(a,e,"Party : Remark",t,n,u,"",r)}function P(e,t,n){return r=>i.mapHeader(r,"LocationRef : Header",e,t,n)}function y(e,t,n){return r=>i.mapHeader(r,"Party : Header",e,t,n)}function R(e,n,a,i){return new Promise(async function(u){const o=t.default.differenceWith(e,n,(e,t)=>e.name===t.name),m=t.default.differenceWith(n,e,(e,t)=>e.name===t.name);if(o.length>0){const e=await r.Party(i,a).insertMany(o);u([...n,...e])}else m.length>0?(await r.Party(i,a).deleteMany({_id:{$in:[...m.map(e=>e._id)]}}),u(t.default.differenceWith(n,m,(e,t)=>e.name===t.name))):u(n)})}function h(e){return a.SchemaParty.findOne({gtmVersion:e}).sort({_id:1})}exports.getPartySchema=n.default(h,{maxAge:6e4}),exports.getPartyData=n.default(u,{maxAge:6e4}),exports.getUpdatedProp=n.default(R,{maxAge:6e4});
},{"../../models/party":"Ovyc","../../models/schemaParty":"axFa","./partyProps":"Bhcp"}],"HAOJ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../renamer"),a=e(require("lodash")),r=require("../other"),n=e=>{const t={};return a.default.keys(e).map(e=>s(e,t)).filter(e=>void 0!==e),t},s=(e,t)=>{switch(!0){case-1!==e.search("Remark"):o(e,t,"Remark");break;case-1!==e.search("Refnum"):o(e,t,"Refnum");break;case-1!==e.search("AddressLines"):o(e,t,"AddressLines");break;default:o(e,t,"Header")}return t};exports.getChilds=(e=>{const t={Contact:{},LocationRef:{}};return a.default.keys(e).map(a=>{switch(!0){case-1===a.search("GtmContact"):break;case-1!==a.search("LocationRef"):c(a,e,t,"LocationRef");break;default:c(a,e,t,"Contact")}return t}).filter(e=>void 0!==e),t.Contact=n(t.Contact),t.LocationRef=n(t.LocationRef),{GtmContact:t}});const c=(e,t,a,r)=>{a[`${r}`][`${e}`]=t[`${e}`]},o=(e,n,s)=>{let c=e,o=e;switch(!0){case"Remark"===s:c=r.convertPath(e,"Remark").newPath,o=r.convertPath(e,"Remark").newName;break;case"Refnum"===s:c=r.convertPath(e,"Refnum").newPath,o=r.convertPath(e,"Refnum").newName;break;case"AddressLines"===s:c=r.convertPath(e,"AddressLines").newPath,o=r.convertPath(e,"AddressLines").newName}n[`${s}`]||(n[`${s}`]=[]),n[`${s}`].push({name:t.getElementName(o),path:c}),n[`${s}`]=a.default.uniqBy(n[`${s}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"abiS":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./../index"),a=e(require("express")),r=a.default.Router(),s=e(require("path")),n=e(require("fast-xml-parser")),i=e(require("flat")),o=require("../helper/other"),u=require("../helper/Party/schemaPartyProps"),l=require("../models/schemaParty");async function m(){const e=s.default.join(t.ROOT_DIR,"XMLs","Party.xml"),a=await o.getFileData(e),r=n.default.getTraversalObj(a,{}),m=n.default.convertToJson(r,{}),d=i.default(m),c=u.getChilds(d);let{gtmVersion:f,xmlNsOtm:y,xmlNsGtm:g}=o.getXMlVersion(a);return f||(f=Number(o.CONSTS.GTMVERSION)),new l.SchemaParty({xmlNs:[y,g],gtmVersion:f,...c}).save()}r.post("/",o.asyncRouteHandler(async(e,a)=>{const r=s.default.join(t.ROOT_DIR,"XMLs","Party.xml"),m=await o.getFileData(r),d=n.default.getTraversalObj(m,{}),c=n.default.convertToJson(d,{}),f=i.default(c),y=u.getChilds(f),{gtmVersion:g,xmlNsOtm:h,xmlNsGtm:O}=o.getXMlVersion(m);if(!g)return a.status(400).send("XML must contain Namespace");let x=await l.SchemaParty.findOne({gtmVersion:g});if(x){if(JSON.stringify(x.GtmContact)===JSON.stringify(y.GtmContact))return a.status(200).send(x);await l.SchemaParty.findByIdAndRemove(x._id)}return x=new l.SchemaParty({xmlNs:[h,O],gtmVersion:g,...y}),x=await x.save(),a.status(200).send(x)})),r.get("/",o.asyncRouteHandler(async(e,t)=>{const{gtmVersion:a}=e.query;if(!a){const e=await l.SchemaParty.find().sort({gtmVersion:-1});return t.status(200).send(e)}const r=await l.SchemaParty.findOne({gtmVersion:a});return r?t.status(200).send(r):t.status(400).send(`gtmVersion:${a} schema not available!`)})),exports.default=r,exports.generatePartySchema=m;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Party/schemaPartyProps":"HAOJ","../models/schemaParty":"axFa"}],"TT7J":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("express")),a=e.default.Router(),r=require("../helper/other"),n=require("../helper/dbXmlQuery"),s=require("../helper/Party/getPartyData"),u=require("../api/gtm"),i=require("../models/party"),o=t(require("../middleware/auth")),d=require("./schemaParty");async function y(t,e,a){return await i.Party(t,e).find({display:a}).sort({_id:1})}async function l(t,e){return await i.Party(t,e).find({}).sort({_id:1})}function c(t){return{data:t.filter(t=>t.display)}}async function f(t,e,a){return{data:await i.Party(t,e).insertMany(a)}}function p(t){return!t||0===t.length}function m(t){return+t.query.gtmVersion||+r.CONSTS.GTMVERSION}function w(t){return t.split(".")[0]}a.get("/",[o.default],r.asyncRouteHandler(async(t,e)=>{const{display:a}=t.query,{username:i,password:o,instance:P,url:g}=t.user,h=w(i);if(a){const t=await y(h,P,a);if(t.length)return e.status(200).json({data:t})}const q=m(t);let _=await s.getPartySchema(q);_||(_=await d.generatePartySchema());const{data:j,error:S}=await r.asyncHandler(u.dbXml(g,n.getPartyPropfromGtm,i,o));if(S)return e.status(400).send(S);const b=await s.getPartyData(_,q,j,h);let M=await l(h,P);return p(M)?e.status(200).json(await f(h,P,b)):(M=await s.getUpdatedProp(b,M,P,h),a?e.status(200).json(c(M)):e.status(200).json({data:M}))})),a.put("/",[o.default],r.asyncRouteHandler(async(t,e)=>{let{party:a}=t.body;const{username:r,instance:n}=t.user,s=w(r);return a?(a=await i.Party(s,n).findByIdAndUpdate(a._id,a,{new:!0}),e.status(200).json({data:a})):e.status(400).send("Party prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Party/getPartyData":"dEF4","../api/gtm":"KJs0","../models/party":"Ovyc","../middleware/auth":"MNoc","./schemaParty":"abiS"}],"fEfK":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),a=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]});exports.Transaction=((e,n)=>t.default.model("Transaction",a,`${e}_Transaction_${n}`));
},{}],"Poy0":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),a=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},GtmTransaction:{type:"Mixed"}});exports.SchemaTransaction=t.default.model("SchemaTransaction",a,"TransactionSchema");
},{}],"JLzc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../other"),a=require("../renamer"),t=["Transaction ID DomainName","Transaction ID","Transaction TransactionCode","Line ID DomainName","Line ID","Line TransactionCode"],r=(a,t,r)=>{const p=e.capitalize(r.split("_").join(" "));return p.split(".")[1]?p.split(".")[1]:p},p=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};exports.mapHeader=((e,r,p,i,l)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,t),display:a.getMandatoryElement(e.name,t),type:r,displayText:e.name,defaultValue:a.getDefaultValue(e.path,l),isMandatory:a.getMandatoryElement(e.name,t),path:[e.path],gtmVersion:p,xmlNs:i})),exports.mapRefnum=((t,i,l,n,m,u,d,s)=>{const o=p(i,"Xid"),D=p(i,"DomainName"),c=p(i,"RefnumValue"),h=p(i,"TransactionCode");return{name:`${d} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${d} ${r(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(i[c].path,s),path:[{path:i[c].path.replace("INDEX",u),value:""},e.getDomainName(t,i[D].path.replace("INDEX",u)),e.getTC(t,i[h].path.replace("INDEX",u)),e.getXID(t,i[o].path.replace("INDEX",u))],gtmVersion:n,xmlNs:m}}),exports.mapRemark=((t,i,l,n,m,u,d,s)=>{const o=p(i,"Xid"),D=p(i,"DomainName"),c=p(i,"RemarkText"),h=p(i,"RemarkSequence"),y=p(i,"TransactionCode");return{name:`${d} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${d} ${r(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(i[c].path,s),path:[{path:i[c].path.replace("INDEX",u),value:""},e.getTC(t,i[y].path.replace("INDEX",u)),e.getSequence(t,i[h].path.replace("INDEX",u),u),e.getDomainName(t,i[D].path.replace("INDEX",u)),e.getXID(t,i[o].path.replace("INDEX",u))],gtmVersion:n,xmlNs:m}}),exports.mapQuantity=((t,i,l,n,m,u,d,s,o)=>o[t.replace(/.*\[|\]/gi,"")].map(o=>{t=t.split("[")[0];const D=p(i,/QuantityTypeGid(.*?)Xid/),c=p(i,/QuantityTypeGid(.*?)DomainName/),h=p(i,/Quantity(.*?)QuantityValue/),y=p(i,/Quantity(.*?)SequenceNumber/),I=p(i,/Quantity(.*?)TransactionCode/),N=p(i,/Quantity(.*?)UOM/);return{name:`${d} ${t} (${o})`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${d} ${r(0,0,t)} (${o})`.trim(),defaultValue:a.getDefaultValue(i[h].path,s),path:[{path:i[h].path.replace("INDEX",u),value:""},e.getTC(t,i[I].path.replace("INDEX",u)),e.getSequence(t,i[y].path.replace("INDEX",u),u),e.getDomainName(t,i[c].path.replace("INDEX",u)),{path:i[N].path.replace("INDEX",u),value:o},e.getXID(t,i[D].path.replace("INDEX",u))],gtmVersion:n,xmlNs:m}})),exports.mapCurrency=((t,i,l,n,m,u,d,s)=>{const o=p(i,/GtmCurrencyTypeGid(.*?)Xid/),D=p(i,/GtmCurrencyTypeGid(.*?)DomainName/),c=p(i,/CurrencyValue(.*?)MonetaryAmount/),h=p(i,/CurrencyValue(.*?)GlobalCurrencyCode/);return{name:`${d} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${d} ${r(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(i[c].path,s),path:[{path:i[c].path.replace("INDEX",u),value:""},e.getDomainName(t,i[D].path.replace("INDEX",u)),{path:i[h].path.replace("INDEX",u),value:"USD"},e.getXID(t,i[o].path.replace("INDEX",u))],gtmVersion:n,xmlNs:m}}),exports.mapInvolvedParty=((t,i,l,n,m,u,d,s="")=>{const o=p(i,/InvolvedPartyQualifierGid(.*?)Xid/),D=p(i,/ContactGid(.*?)Xid/),c=p(i,/ContactGid(.*?)DomainName/),h=p(i,"TransactionCode");return{name:`${d} ${t} (Party ID)`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${d} ${r(0,0,t)} (Party ID)`.trim(),defaultValue:a.getDefaultValue(i[D].path,s),path:[{path:i[D].path.replace("INDEX",u),value:""},e.getTC(t,i[h].path.replace("INDEX",u)),{path:i[c].path.replace("INDEX",u),value:s},e.getXID(t,i[o].path.replace("INDEX",u))],gtmVersion:n,xmlNs:m}}),exports.mapDate=((t,i,l,n,m,u,d,s="")=>{const o=p(i,/DateQualifierGid(.*?)Xid/),D=p(i,/TransactionDate(.*?)GLogDate/),c=p(i,/DateQualifierGid(.*?)DomainName/);return{name:`${d} ${t} (YYYY-MM-DD)`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${d} ${r(0,0,t)} (YYYY-MM-DD)`.trim(),defaultValue:a.getDefaultValue(i[D].path,s),path:[{path:i[D].path.replace("INDEX",u),value:""},e.getDomainName(t,i[c].path.replace("INDEX",u)),e.getXID(t,i[o].path.replace("INDEX",u))],gtmVersion:n,xmlNs:m}}),exports.mapTrxLineItemId=((e,a,t,r,i,l,n,m="")=>{const u=p(a,/ItemGid(.*?)Xid/),d=p(a,/ItemGid(.*?)DomainName/);return{name:`${n} Item ID`.trim(),required:!0,disabled:!1,display:!1,type:t,displayText:`${n} Item ID`.trim(),defaultValue:"",path:[{path:a[u].path.replace("INDEX",l),value:""},{path:a[d].path.replace("INDEX",l),value:m}],gtmVersion:r,xmlNs:i}});
},{"../other":"irtd","../renamer":"jN2X"}],"ZiiO":[function(require,module,exports) {
"use strict";var n=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(exports,"__esModule",{value:!0});const e=n(require("lodash")),t=n(require("promise-memoize")),r=require("../../models/transaction"),a=require("../../models/schemaTransaction"),i=require("./transactionProps");function u(n,t,r,a){return new Promise(function(i){let{Header:u,Remark:x,Refnum:L,InvolvedParty:y,TransDate:R,Quantity:D,Currency:h}=n.GtmTransaction.GtmTransaction,{Header:I,Remark:v,Refnum:P,InvolvedParty:E,ItemGid:g,TransLineDate:C,Quantity:Q,Currency:H}=n.GtmTransaction.GtmTransactionLine;const _=n.xmlNs;({TrxHeader:u,TrxLineHeader:I}=l(u,t,_,a,I)),({TrxRemark:x,TrxLineRemark:v}=d(r,x,t,_,a,v)),({TrxDate:R,TrxLineDate:C}=p(r,R,t,_,a,C)),({TrxQty:D,TrxLineQty:Q}=f(r,D,t,_,a,Q)),({TrxCur:h,TrxLineCur:H}=T(r,h,t,_,a,H)),g=s(g,t,_,a),({TrxRefnum:L,TrxLineRefnum:P}=m(r,L,t,_,a,P)),({TrxInvPty:y,TrxLineInvPty:E}=o(r,y,t,_,a,E)),i(e.default.uniqBy([...u,...x,...L,...y,...D,...h,...R,...I,...g,...v,...P,...E,...Q,...H,...C],c()))})}function c(){return n=>n.name}function o(n,e,t,r,a,i){const u=n.match(/INVOLVED_PARTY="(.*?)"/)[1].split(",");return{TrxInvPty:e=u.map(L(e,t,r,a)),TrxLineInvPty:i=u.map(x(i,t,r,a))}}function m(n,e,t,r,a,i){const u=n.match(/REFNUMS="(.*?)"/)[1].split(",");return{TrxRefnum:e=u.map(R(e,t,r,a)),TrxLineRefnum:i=u.map(y(i,t,r,a))}}function s(n,e,t,r){return n=[0].map(D(n,e,t,r))}function f(n,t,r,a,i,u){const c=n.match(/QUANTITY="(.*?)"/)[1].split(","),o=U(n);return{TrxQty:t=e.default.flattenDeep(c.map(P(t,r,a,i,o))),TrxLineQty:u=e.default.flattenDeep(c.map(h(u,r,a,i,o)))}}function T(n,e,t,r,a,i){const u=n.match(/CURRENCY="(.*?)"/)[1].split(",");return{TrxCur:e=u.map(v(e,t,r,a)),TrxLineCur:i=u.map(I(i,t,r,a))}}function p(n,e,t,r,a,i){const u=n.match(/DATES="(.*?)"/)[1].split(",");return{TrxDate:e=u.map(g(e,t,r,a)),TrxLineDate:i=u.map(E(i,t,r,a))}}function d(n,e,t,r,a,i){const u=n.match(/REMARKS="(.*?)"/)[1].split(",");return{TrxRemark:e=u.map(Q(e,t,r,a)),TrxLineRemark:i=u.map(C(i,t,r,a))}}function l(n,e,t,r,a){return{TrxHeader:n=n.map(_(e,t,r)),TrxLineHeader:a=a.map(H(e,t,r))}}function x(n,e,t,r){return(a,u)=>i.mapInvolvedParty(a,n,"Transaction Line : Involved Party",e,t,u,"Line",r)}function L(n,e,t,r){return(a,u)=>i.mapInvolvedParty(a,n,"Transaction : Involved Party",e,t,u,"",r)}function y(n,e,t,r){return(a,u)=>i.mapRefnum(a,n,"Transaction Line : Refnum",e,t,u,"Line",r)}function R(n,e,t,r){return(a,u)=>i.mapRefnum(a,n,"Transaction : Refnum",e,t,u,"",r)}function D(n,e,t,r){return(a,u)=>i.mapTrxLineItemId(a,n,"Transaction Line : Header",e,t,0,"Line",r)}function h(n,e,t,r,a){return(u,c)=>i.mapQuantity(u,n,"Transaction Line : Quantity",e,t,c,"Line",r,a)}function I(n,e,t,r){return(a,u)=>i.mapCurrency(a,n,"Transaction Line : Currency",e,t,u,"Line",r)}function v(n,e,t,r){return(a,u)=>i.mapCurrency(a,n,"Transaction : Currency",e,t,u,"",r)}function P(n,e,t,r,a){return(u,c)=>i.mapQuantity(u,n,"Transaction : Quantity",e,t,c,"",r,a)}function E(n,e,t,r){return(a,u)=>i.mapDate(a,n,"Transaction Line : Date",e,t,u,"Line",r)}function g(n,e,t,r){return(a,u)=>i.mapDate(a,n,"Transaction : Date",e,t,u,"",r)}function C(n,e,t,r){return(a,u)=>i.mapRemark(a,n,"Transaction Line : Remark",e,t,u,"Line",r)}function Q(n,e,t,r){return(a,u)=>i.mapRemark(a,n,"Transaction : Remark",e,t,u,"",r)}function H(n,e,t){return r=>i.mapHeader(r,"Transaction Line : Header",n,e,t)}function _(n,e,t){return r=>i.mapHeader(r,"Transaction : Header",n,e,t)}function k(n,t,a,i){return new Promise(async function(u){const c=e.default.differenceWith(n,t,(n,e)=>n.name===e.name),o=e.default.differenceWith(t,n,(n,e)=>n.name===e.name);if(c.length>0){const n=await r.Transaction(i,a).insertMany(c);u([...t,...n])}else o.length>0?(await r.Transaction(i,a).deleteMany({_id:{$in:[...o.map(n=>n._id)]}}),u(e.default.differenceWith(t,o,(n,e)=>n.name===e.name))):u(t)})}function N(n){return a.SchemaTransaction.findOne({gtmVersion:n}).sort({_id:1})}function U(n){const e=n.match(/QUANTITY_UOM="(.*?)"/)[1].split(","),t={};return e.forEach(n=>{t[n.replace(/.*\[|\]/gi,"")]?t[n.replace(/.*\[|\]/gi,"")].push(n.split("[")[0]):t[n.replace(/.*\[|\]/gi,"")]=[n.split("[")[0]],t["USER DEFINED"]?t["USER DEFINED"].push(n.split("[")[0]):t["USER DEFINED"]=[n.split("[")[0]]}),t}exports.getTransactionSchema=t.default(N,{maxAge:6e4}),exports.getTransactionData=t.default(u,{maxAge:6e4}),exports.getUpdatedProp=t.default(k,{maxAge:6e4});
},{"../../models/transaction":"fEfK","../../models/schemaTransaction":"Poy0","./transactionProps":"JLzc"}],"THe0":[function(require,module,exports) {
"use strict";var a=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../renamer"),t=a(require("lodash")),n=require("../other"),r=a=>{const e={};return t.default.keys(a).map(a=>c(a,e)).filter(a=>void 0!==a),e},c=(a,e)=>{switch(!0){case-1!==a.search("ItemGid"):o(a,e,"ItemGid");break;case-1!==a.search("Currency"):o(a,e,"Currency");break;case-1!==a.search("TransactionCurrency"):o(a,e,"TransactionCurrency");break;case-1!==a.search("Quantity"):o(a,e,"Quantity");break;case-1!==a.search("TransactionQuantity"):o(a,e,"TransactionQuantity");break;case-1!==a.search("TransLineDate"):o(a,e,"TransLineDate");break;case-1!==a.search("TransDate"):o(a,e,"TransDate");break;case-1!==a.search("TransactionInvLocation"):o(a,e,"TransactionInvLocation");break;case-1!==a.search("InvolvedParty"):o(a,e,"InvolvedParty");break;case-1!==a.search("UserDefinedClassification"):o(a,e,"UserDefinedClassification");break;case-1!==a.search("PortInfo"):o(a,e,"PortInfo");break;case-1!==a.search("Remark"):o(a,e,"Remark");break;case-1!==a.search("Refnum"):o(a,e,"Refnum");break;case-1!==a.search("Contact"):o(a,e,"Contact");break;default:o(a,e,"Header")}return e};exports.getChilds=(a=>{const e={GtmTransaction:{},GtmTransactionLine:{}};return t.default.keys(a).map(t=>{switch(!0){case-1===t.search("GtmTransaction"):break;case-1!==t.search("GtmTransactionLine"):s(t,a,e,"GtmTransactionLine");break;default:s(t,a,e,"GtmTransaction")}return e}).filter(a=>void 0!==a),e.GtmTransaction=r(e.GtmTransaction),e.GtmTransactionLine=r(e.GtmTransactionLine),{GtmTransaction:e}});const s=(a,e,t,n)=>{t[`${n}`][`${a}`]=e[`${a}`]},o=(a,r,c)=>{let s=a,o=a;switch(!0){case"ItemGid"===c:s=n.convertPath(a,"ItemGid").newPath,o=n.convertPath(a,"ItemGid").newName;break;case"Currency"===c:s=n.convertPath(a,"Currency").newPath,o=n.convertPath(a,"Currency").newName;break;case"TransactionCurrency"===c:s=n.convertPath(a,"TransactionCurrency").newPath,o=n.convertPath(a,"TransactionCurrency").newName;break;case"Quantity"===c:s=n.convertPath(a,"Quantity").newPath,o=n.convertPath(a,"Quantity").newName;break;case"TransactionQuantity"===c:s=n.convertPath(a,"TransactionQuantity").newPath,o=n.convertPath(a,"TransactionQuantity").newName;break;case"TransLineDate"===c:s=n.convertPath(a,"TransLineDate").newPath,o=n.convertPath(a,"TransLineDate").newName;break;case"TransDate"===c:s=n.convertPath(a,"TransDate").newPath,o=n.convertPath(a,"TransDate").newName;break;case"TransactionInvLocation"===c:s=n.convertPath(a,"TransactionInvLocation").newPath,o=n.convertPath(a,"TransactionInvLocation").newName;break;case"UserDefinedClassification"===c:s=n.convertPath(a,"UserDefinedClassification").newPath,o=n.convertPath(a,"UserDefinedClassification").newName;break;case"Remark"===c:s=n.convertPath(a,"Remark").newPath,o=n.convertPath(a,"Remark").newName;break;case"PortInfo"===c:s=n.convertPath(a,"PortInfo").newPath,o=n.convertPath(a,"PortInfo").newName;break;case"Refnum"===c:s=n.convertPath(a,"Refnum").newPath,o=n.convertPath(a,"Refnum").newName;break;case"InvolvedParty"===c:s=n.convertPath(a,"InvolvedParty").newPath,o=n.convertPath(a,"InvolvedParty").newName;break;case"Contact"===c:s=n.convertPath(a,"Contact").newPath,o=n.convertPath(a,"Contact").newName}r[`${c}`]||(r[`${c}`]=[]),r[`${c}`].push({name:e.getElementName(o),path:s}),r[`${c}`]=t.default.uniqBy(r[`${c}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"DV7a":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./../index"),a=e(require("express")),s=a.default.Router(),n=e(require("path")),r=e(require("fast-xml-parser")),i=e(require("flat")),o=require("../helper/other"),u=require("../helper/Transaction/schemaTransactionProps"),c=require("../models/schemaTransaction");async function l(){const e=n.default.join(t.ROOT_DIR,"XMLs","GtmTransaction.xml"),a=await o.getFileData(e),s=r.default.getTraversalObj(a,{}),l=r.default.convertToJson(s,{}),m=i.default(l),d=u.getChilds(m);let{gtmVersion:f,xmlNsOtm:T,xmlNsGtm:g}=o.getXMlVersion(a);return f||(f=Number(o.CONSTS.GTMVERSION)),new c.SchemaTransaction({xmlNs:[T,g],gtmVersion:f,...d}).save()}s.post("/",o.asyncRouteHandler(async(e,a)=>{const s=n.default.join(t.ROOT_DIR,"XMLs","GtmTransaction.xml"),l=await o.getFileData(s),m=r.default.getTraversalObj(l,{}),d=r.default.convertToJson(m,{}),f=i.default(d),T=u.getChilds(f),{gtmVersion:g,xmlNsOtm:h,xmlNsGtm:x}=o.getXMlVersion(l);if(!g)return a.status(400).send("XML must contain Namespace");let O=await c.SchemaTransaction.findOne({gtmVersion:g});if(O){if(JSON.stringify(O.GtmTransaction)===JSON.stringify(T.GtmTransaction))return a.status(200).send(O);await c.SchemaTransaction.findByIdAndRemove(O._id)}return O=new c.SchemaTransaction({xmlNs:[h,x],gtmVersion:g,...T}),O=await O.save(),a.status(200).send(O)})),s.get("/",o.asyncRouteHandler(async(e,t)=>{const{gtmVersion:a}=e.query;if(!a){const e=await c.SchemaTransaction.find().sort({gtmVersion:-1});return t.status(200).send(e)}const s=await c.SchemaTransaction.findOne({gtmVersion:a});return s?t.status(200).send(s):t.status(400).send(`gtmVersion:${a} schema not available!`)})),exports.default=s,exports.generateTrxSchema=l;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Transaction/schemaTransactionProps":"THe0","../models/schemaTransaction":"Poy0"}],"F2tt":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const a=t(require("express")),e=a.default.Router(),n=require("../helper/other"),r=require("../helper/dbXmlQuery"),s=require("../helper/Transaction/getTransactionData"),i=require("../api/gtm"),u=require("../models/transaction"),o=t(require("../middleware/auth")),c=require("./schemaTransaction");async function d(t,a,e){return await u.Transaction(t,a).find({display:e}).sort({_id:1})}async function l(t,a,e){return t=await u.Transaction(a,e).findByIdAndUpdate(t._id,t,{new:!0})}async function f(t,a){return await u.Transaction(t,a).find({}).sort({_id:1})}function p(t){return{data:t.filter(t=>t.display)}}async function y(t,a,e){return{data:await u.Transaction(t,a).insertMany(e)}}function w(t){return!t||0===t.length}function m(t){return+t.query.gtmVersion||+n.CONSTS.GTMVERSION}function T(t){return t.split(".")[0]}e.get("/",[o.default],n.asyncRouteHandler(async(t,a)=>{const{display:e}=t.query,{username:u,password:o,instance:l,url:g}=t.user,h=T(u);if(e){const t=await d(h,l,e);if(t.length)return a.status(200).json({data:t})}const q=m(t);let _=await s.getTransactionSchema(q);_||(_=await c.generateTrxSchema());const{data:j,error:S}=await n.asyncHandler(i.dbXml(g,r.getTransactionPropsfromGtm,u,o));if(S)return a.status(400).send(S);const b=await s.getTransactionData(_,q,j,h);let x=await f(h,l);return w(x)?a.status(200).json(await y(h,l,b)):(x=await s.getUpdatedProp(b,x,l,h),e?a.status(200).json(p(x)):a.status(200).json({data:x}))})),e.put("/",[o.default],n.asyncRouteHandler(async(t,a)=>{let{transaction:e}=t.body;const{username:n,instance:r}=t.user,s=T(n);return e?(e=await l(e,s,r),a.status(200).json({data:e})):a.status(400).send("Transaction prop value missing!")})),exports.default=e;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Transaction/getTransactionData":"ZiiO","../api/gtm":"KJs0","../models/transaction":"fEfK","../middleware/auth":"MNoc","./schemaTransaction":"DV7a"}],"RHAm":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("mongoose")),t=new r.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]});exports.OrderBase=((e,a)=>r.default.model("OrderBase",t,`${e}_OrderBase_${a}`));
},{}],"TARO":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("mongoose")),t=new r.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},TransOrder:{type:"Mixed"}});exports.SchemaOrderBase=r.default.model("SchemaOrderBase",t,"OrderBaseSchema");
},{}],"cIXx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../other"),a=require("../renamer"),t=require("../other"),i=["OrderBase ID DomainName","OrderBase ID","OrderBase TransactionCode","Line ID DomainName","Line ID","Line TransactionCode",...Object.values(t.NAME.orderBase).filter(e=>!e.includes("TimeZone"))],r=(a,t,i)=>{const r=e.capitalize(i.split("_").join(" "));return r.split(".")[1]?r.split(".")[1]:r};for(let n=0;n<e.getSequence.length;n++){e.getSequence[n]}const p=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};exports.mapHeader=((e,t,r,p,n)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,i),display:a.getMandatoryElement(e.name,i),isMandatory:a.getMandatoryElement(e.name,i),type:t,displayText:e.name,defaultValue:a.getDefaultValue(e.path,n),path:[e.path],gtmVersion:r,xmlNs:p})),exports.mapRefnum=((t,i,n,l,s,m,o,d)=>{const u=p(i,"Xid"),h=p(i,"DomainName"),c=p(i,"RefnumValue"),D=p(i,"TransactionCode");return{name:`${o} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${o} ${r(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(i[c].path,d),path:[{path:i[c].path.replace("INDEX",m),value:""},e.getDomainName(t,i[h].path.replace("INDEX",m)),e.getTC(t,i[D].path.replace("INDEX",m)),e.getXID(t,i[u].path.replace("INDEX",m))],gtmVersion:l,xmlNs:s}}),exports.mapRemark=((t,i,n,l,s,m,o,d)=>{const u=p(i,"Xid"),h=p(i,"DomainName"),c=p(i,"RemarkText"),D=p(i,"RemarkSequence"),g=p(i,"TransactionCode");return{name:`${o} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${o} ${r(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(i[c].path,d),path:[{path:i[c].path.replace("INDEX",m),value:""},e.getTC(t,i[g].path.replace("INDEX",m)),e.getSequence(t,i[D].path.replace("INDEX",m),m),e.getDomainName(t,i[h].path.replace("INDEX",m)),e.getXID(t,i[u].path.replace("INDEX",m))],gtmVersion:l,xmlNs:s}}),exports.mapItemFeature=((t,i,n,l,s,m,o,d)=>{const u=p(i,"Xid"),h=p(i,"DomainName"),c=p(i,"ItemFeatureValue"),D=p(i,"TransactionCode");return{name:`${o} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${o} ${r(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(i[c].path,d),path:[{path:i[c].path,value:""},e.getDomainName(t,i[h].path),e.getTC(t,i[D].path),e.getXID(t,i[u].path)],gtmVersion:l,xmlNs:s}}),exports.mapItemClassification=((t,i,r,n,l,s,m)=>{const o=p(i,"Xid"),d=p(i,"ClassificationCode"),u=p(i,"TransactionCode");return{name:`${t} Classification`,required:!0,disabled:!1,display:!1,type:r,displayText:`${t} Classification`,defaultValue:a.getDefaultValue(i[d].path,m),path:[{path:i[d].path,value:""},e.getTC(t,i[u].path),e.getXID(t,i[o].path)],gtmVersion:n,xmlNs:l}}),exports.mapInvolvedParty=((t,i,n,l,s,m,o,d="")=>{const u=p(i,/InvolvedPartyQualifierGid(.*?)Xid/),h=p(i,/ContactGid(.*?)Xid/),c=p(i,/ContactGid(.*?)DomainName/),D=p(i,"TransactionCode");return{name:`${o} ${t} Contact ID`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${o} ${r(0,0,t)} Contact ID`.trim(),defaultValue:a.getDefaultValue(i[h].path,d),path:[{path:i[h].path,value:""},e.getTC(t,i[D].path),{path:i[c].path,value:d},e.getXID(t,i[u].path)],gtmVersion:l,xmlNs:s}}),exports.mapItemDescription=((t,i,r,n,l,s,m)=>{const o=p(i,"Xid"),d=p(i,"DomainName"),u=p(i,":Description"),h=p(i,"SequenceNumber"),c=p(i,"TransactionCode");return{name:`Description in ${t.split("::")[1]}`,required:!0,disabled:!1,display:!1,type:r,displayText:`Description in ${t.split("::")[1]}`,defaultValue:a.getDefaultValue(i[u].path,m),path:[{path:i[u].path,value:""},e.getTC(t.split("::")[0],i[c].path),e.getSequence(t.split("::")[0],i[h].path,s),e.getDomainName(t.split("::")[0],i[d].path),e.getXID(t.split("::")[0],i[o].path)],gtmVersion:n,xmlNs:l}});
},{"../other":"irtd","../renamer":"jN2X"}],"BAB7":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("lodash")),a=e(require("promise-memoize")),n=require("../../models/orderBase"),t=require("../../models/schemaOrderBase"),s=require("./orderBaseProps");function m(e,a,n,t){return new Promise(function(m){let{Header:d,Remark:i,Refnum:u}=e.TransOrder.OrderBase,{Header:o,Remark:f,Refnum:p}=e.TransOrder.OrderBaseLine;const c=e.xmlNs;d=d.map(e=>s.mapHeader(e,"Order Base : Header",a,c,t)),o=o.map(e=>s.mapHeader(e,"Order Base Line : Header",a,c,t));const l=n.match(/REMARKS="(.*?)"/)[1].split(",");i=l.map((e,r)=>s.mapRemark(e,i,"Order Base : Remark",a,c,r,"",t)),f=l.map((e,r)=>s.mapRemark(e,f,"Order Base Line : Remark",a,c,r,"Line",t));const O=n.match(/REFNUMS="(.*?)"/)[1].split(",");u=O.map((e,r)=>s.mapRefnum(e,u,"Order Base : Refnum",a,c,r,"",t));const B=n.match(/LINE_REFNUMS="(.*?)"/)[1].split(",");p=B.map((e,r)=>s.mapRefnum(e,p,"Order Base Line : Refnum",a,c,r,"Line",t)),m(r.default.uniqBy([...d,...i,...u,...o,...f,...p],e=>e.name))})}function d(e,a,t,s){return new Promise(async function(m){const d=r.default.differenceWith(e,a,(e,r)=>e.name===r.name),i=r.default.differenceWith(a,e,(e,r)=>e.name===r.name);if(d.length>0){const e=await n.OrderBase(s,t).insertMany(d);m([...a,...e])}else i.length>0?(await n.OrderBase(s,t).deleteMany({_id:{$in:[...i.map(e=>e._id)]}}),m(r.default.differenceWith(a,i,(e,r)=>e.name===r.name))):m(a)})}function i(e){return t.SchemaOrderBase.findOne({gtmVersion:e}).sort({_id:1})}exports.getOrderBaseSchema=a.default(i,{maxAge:6e4}),exports.getOrderBaseData=a.default(m,{maxAge:6e4}),exports.getUpdatedProp=a.default(d,{maxAge:6e4});
},{"../../models/orderBase":"RHAm","../../models/schemaOrderBase":"TARO","./orderBaseProps":"cIXx"}],"Xt3B":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("express")),t=r.default.Router(),a=require("../helper/other"),s=require("../helper/dbXmlQuery"),n=require("../helper/OrderBase/getOrderBaseData"),d=require("../api/gtm"),u=require("../models/orderBase"),i=e(require("../middleware/auth"));function o(e){return e.query.gtmVersion?+e.query.gtmVersion:+a.CONSTS.GTMVERSION}t.get("/",[i.default],a.asyncRouteHandler(async(e,r)=>{const{display:t}=e.query,{username:i,password:l,instance:c,url:p}=e.user,f=i.split(".")[0];if(t){const e=await u.OrderBase(f,c).find({display:t}).sort({_id:1});if(e.length)return r.status(200).json({data:e})}const m=o(e),y=await n.getOrderBaseSchema(m);if(!y)return r.status(400).send(`gtmVersion:${m} schema not available!`);const{data:B,error:O}=await a.asyncHandler(d.dbXml(p,s.getOrderBasePropsfromGtm,i,l));if(O)return r.status(400).send(O);const g=await n.getOrderBaseData(y,m,B,f),h=await u.OrderBase(f,c).find({}).sort({_id:1});return h&&0!==h.length?t?r.status(200).json({data:h.filter(e=>e.display)}):r.status(200).json({data:h}):r.status(200).json({data:await u.OrderBase(f,c).insertMany(g)})})),t.put("/",[i.default],a.asyncRouteHandler(async(e,r)=>{let{orderBase:t}=e.body;const{username:a,instance:s}=e.user,n=a.split(".")[0];return t?(t=await u.OrderBase(n,s).findByIdAndUpdate(t._id,t,{new:!0}),r.status(200).json({data:t})):r.status(400).send("OrderBase prop value missing!")})),exports.default=t;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/OrderBase/getOrderBaseData":"BAB7","../api/gtm":"KJs0","../models/orderBase":"RHAm","../middleware/auth":"MNoc"}],"k9TE":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("../renamer"),t=e(require("lodash")),a=require("../other"),s=e=>{const r={};return t.default.keys(e).map(e=>n(e,r)).filter(e=>void 0!==e),r},n=(e,r)=>{switch(!0){case-1!==e.search("InvolvedParty"):u(e,r,"InvolvedParty");break;case-1!==e.search("Remark"):u(e,r,"Remark");break;case-1!==e.search("ItemAttributes"):u(e,r,"ItemAttributes");break;case-1!==e.search("Refnum"):u(e,r,"Refnum");break;default:u(e,r,"Header")}return r};exports.getChilds=(e=>{const r={OrderBase:{},OrderBaseLine:{}};return t.default.keys(e).map(t=>{switch(!0){case-1===t.search("TransOrder"):break;case-1!==t.search("TransOrderLineDetail"):c(t,e,r,"OrderBaseLine");break;default:c(t,e,r,"OrderBase")}return r}).filter(e=>void 0!==e),r.OrderBase=s(r.OrderBase),r.OrderBaseLine=s(r.OrderBaseLine),{TransOrder:r}});const c=(e,r,t,a)=>{t[`${a}`][`${e}`]=r[`${e}`]},u=(e,s,n)=>{let c=e,u=e;switch(!0){case"Remark"===n:c=a.convertPath(e,"Remark").newPath,u=a.convertPath(e,"Remark").newName;break;case"InvolvedParty"===n:c=a.convertPath(e,"InvolvedParty").newPath,u=a.convertPath(e,"InvolvedParty").newName;break;case"Refnum"===n:c=a.convertPath(e,"Refnum").newPath,u=a.convertPath(e,"Refnum").newName;break;case"ItemAttributes"===n:c=a.convertPath(e,"ItemAttributes").newPath,u=a.convertPath(e,"ItemAttributes").newName}s[`${n}`]||(s[`${n}`]=[]),s[`${n}`].push({name:r.getElementName(u),path:c}),s[`${n}`]=t.default.uniqBy(s[`${n}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"KJCd":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("./../index"),t=e(require("express")),s=t.default.Router(),a=e(require("path")),n=e(require("fast-xml-parser")),i=e(require("flat")),d=require("../helper/other"),u=require("../helper/OrderBase/schemaOrderBaseProps"),o=require("../models/schemaOrderBase");s.post("/",d.asyncRouteHandler(async(e,t)=>{const s=a.default.join(r.ROOT_DIR,"XMLs","OrderBase.xml"),l=await d.getFileData(s),m=n.default.getTraversalObj(l,{}),c=n.default.convertToJson(m,{}),f=i.default(c),O=u.getChilds(f),{gtmVersion:h,xmlNsOtm:g,xmlNsGtm:p}=d.getXMlVersion(l);if(!h)return t.status(400).send("XML must contain Namespace");let B=await o.SchemaOrderBase.findOne({gtmVersion:h});if(B){if(JSON.stringify(B.TransOrder)===JSON.stringify(O.TransOrder))return t.status(200).send(B);await o.SchemaOrderBase.findByIdAndRemove(B._id)}return B=new o.SchemaOrderBase({xmlNs:[g,p],gtmVersion:h,...O}),B=await B.save(),t.status(200).send(B)})),s.get("/",d.asyncRouteHandler(async(e,r)=>{const{gtmVersion:t}=e.query;if(!t){const e=await o.SchemaOrderBase.find().sort({gtmVersion:-1});return r.status(200).send(e)}const s=await o.SchemaOrderBase.findOne({gtmVersion:t});return s?r.status(200).send(s):r.status(400).send(`gtmVersion:${t} schema not available!`)})),exports.default=s;
},{"./../index":"Focm","../helper/other":"irtd","../helper/OrderBase/schemaOrderBaseProps":"k9TE","../models/schemaOrderBase":"TARO"}],"OHIs":[function(require,module,exports) {
"use strict";function e(e,s,t){if(!e.user.isAdmin)return s.status(403).send("Access denied.");t()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"YYHk":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},t=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(exports,"__esModule",{value:!0});const n=e(require("express")),a=n.default.Router(),s=e(require("fs")),i=e(require("path")),r=t(require("fs-extra")),u=require("util"),d=u.promisify(s.default.readFile),l=u.promisify(s.default.writeFile),f=e(require("multiparty")),o=e(require("../middleware/auth")),c=e(require("../middleware/admin")),_=require("../models/setting"),m=require("../helper/other");async function y(e,t){const n=await d(e);await l(t,n)}a.get("/",[o.default,c.default],m.asyncRouteHandler(async(e,t)=>{const{username:n,instance:a}=e.user,r=n.split(".")[0];s.default.readdir(i.default.join(__dirname,"..","csv",a,r),async(e,n)=>{const u=[];if(e)return!s.default.existsSync(i.default.join(__dirname,"..","csv"))&&s.default.mkdirSync(i.default.join(__dirname,"..","csv")),!s.default.existsSync(i.default.join(__dirname,"..","csv",a))&&s.default.mkdirSync(i.default.join(__dirname,"..","csv",a)),!s.default.existsSync(i.default.join(__dirname,"..","csv",a,r))&&s.default.mkdirSync(i.default.join(__dirname,"..","csv",a,r)),t.status(200).json({data:{files:[]}});for(let t=0;t<n.length;t++){const e=n[t].toString().split("$$$");u.push({id:t+1,uploaduser:e[0],userrole:e[1],uploaddate:e[2],filename:e[3]})}const d=await _.Setting(a).findOne();return t.status(200).json({data:{files:u,setting:d}})})})),a.post("/",[o.default],m.asyncRouteHandler(async(e,t)=>{const{username:n,instance:a}=e.user,r=n.split(".")[0];(new f.default.Form).parse(e,function(e,n,u){const d=u[Object.keys(u)[0]][0].fieldName;d||t.status(400).json("FileName not provided!");const l=u[Object.keys(u)[0]][0].path;return s.default.existsSync(i.default.join(__dirname,"..","csv"))||s.default.mkdirSync(i.default.join(__dirname,"..","csv")),s.default.existsSync(i.default.join(__dirname,"..","csv",a))||s.default.mkdirSync(i.default.join(__dirname,"..","csv",a)),s.default.existsSync(i.default.join(__dirname,"..","csv",a,r))||s.default.mkdirSync(i.default.join(__dirname,"..","csv",a,r)),y(l,i.default.join(__dirname,"..","csv",a,r,d)),t.status(200).json({data:"CSV saved to server."})})})),a.get("/files",[o.default,c.default],m.asyncRouteHandler(async(e,t)=>{const{username:n,instance:a}=e.user,r=n.split(".")[0],u=e.query.file;s.default.exists(i.default.join(__dirname,"..","csv",a,r,u),function(e){if(!e)return t.status(404).end(`File ${u} not found!`);s.default.readFile(i.default.join(__dirname,"..","csv",a,r,u),function(e,n){return e?t.status(500).end(`Error getting the file: ${e}.`):t.send(n.toString("UTF-8"))})})})),a.delete("/files",[o.default,c.default],async(e,t)=>{const{username:n,instance:a}=e.user,r=n.split(".")[0],u=e.query.file;s.default.exists(i.default.join(__dirname,"..","csv",a,r,u),function(e){if(!e)return t.status(404).end(`File ${u} not found!`);s.default.unlink(i.default.join(__dirname,"..","csv",a,r,u),function(e){return e?t.status(500).end(`Error deleting the file: ${e}.`):t.send({data:{success:!0}})})})}),a.delete("/files/all",[o.default,c.default],async(e,t)=>{const{username:n,instance:a}=e.user,s=n.split(".")[0];r.exists(i.default.join(__dirname,"..","csv",a,s),function(e){if(!e)return t.status(404).end("Files not found!");r.remove(i.default.join(__dirname,"..","csv",a,s),function(e){return e?t.status(500).end(`Error deleting the file: ${e}.`):t.send({data:{success:!0}})})})}),exports.default=a;
},{"../middleware/auth":"MNoc","../middleware/admin":"OHIs","../models/setting":"IMRL","../helper/other":"irtd"}],"UddP":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("express")),a=t.default.Router(),r=require("../helper/other"),s=require("../models/setting"),n=e(require("../middleware/auth"));a.get("/",[n.default],r.asyncRouteHandler(async(e,t)=>{const{instance:a,url:n}=e.user;let u=await s.Setting(a).findOne();return u?t.status(200).json({data:u}):(u=await s.Setting(a).create({url:n,version:+r.CONSTS.GTMVERSION}),t.status(200).json({data:u}))})),a.put("/",[n.default],r.asyncRouteHandler(async(e,t)=>{const{instance:a}=e.user;let{setting:r}=e.body;return r=await s.Setting(a).findByIdAndUpdate(r._id,r,{new:!0}),t.status(200).json({data:r})})),exports.default=a;
},{"../helper/other":"irtd","../models/setting":"IMRL","../middleware/auth":"MNoc"}],"Ytvl":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),n=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]});exports.TrackingEvent=((e,r)=>t.default.model("TrackingEvent",n,`${e}_TrackingEvent_${r}`));
},{}],"bLgw":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),r=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},ShipmentStatus:{type:"Mixed"}});exports.SchemaTrackingEvent=t.default.model("SchemaTrackingEvent",r,"TrackingEventSchema");
},{}],"sUtY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../other"),a=require("../renamer"),t=["Status Code ID","Status Code ID DomainName","Stop Sequence Num","Time Zone ID","Log Date","Responsible Party ID DomainName","Responsible Party ID"],p=(a,t,p)=>{const n=e.capitalize(p.split("_").join(" "));return n.split(".")[1]?n.split(".")[1]:n},n=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};exports.mapHeader=((e,p,n,r,s)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,t),display:a.getMandatoryElement(e.name,t),type:p,displayText:e.name,defaultValue:a.getDefaultValue(e.path,s),path:[e.path],gtmVersion:n,xmlNs:r})),exports.mapRefnum=((t,i,l,o,m,u,d)=>{const D=n(i,"Xid"),h=n(i,"DomainName"),c=n(i,"ShipmentRefnumValue"),I=n(i,"TransactionCode");return{name:r(t),required:!0,disabled:s(t),display:s(t),type:l,displayText:r(p(0,0,t)),defaultValue:a.getDefaultValue(i[c].path,d),path:[{path:i[c].path.replace("INDEX",u),value:""},e.getDomainName(t,i[h].path.replace("INDEX",u)),e.getTC(t,i[I].path.replace("INDEX",u)),e.getXID(t,i[D].path.replace("INDEX",u))],gtmVersion:o,xmlNs:m}});const r=e=>"GLOG"===e.toUpperCase()?"Shipment ID":e,s=e=>"GLOG"===e.toUpperCase();
},{"../other":"irtd","../renamer":"jN2X"}],"GO0I":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const n=e(require("lodash")),t=e(require("promise-memoize")),a=require("../../models/trackingEvent"),r=require("../../models/schemaTrackingEvent"),i=require("./trackingEventProps");function m(e,t,a,r){return new Promise(function(m){let{Header:u,Refnum:c}=e.ShipmentStatus;const s=e.xmlNs;u=u.map(e=>i.mapHeader(e,"TrackingEvent : Header",t,s,r));const o=a.match(/REFNUMS="(.*?)"/)[1].split(",");c=o.map((e,n)=>i.mapRefnum(e,c,"TrackingEvent : Refnum",t,s,n,r)),m(n.default.uniqBy([...u,...c],e=>e.name))})}function u(e,t,r,i){return new Promise(async function(m){const u=n.default.differenceWith(e,t,(e,n)=>e.name===n.name),c=n.default.differenceWith(t,e,(e,n)=>e.name===n.name);if(u.length>0){const e=await a.TrackingEvent(i,r).insertMany(u);m([...t,...e])}else c.length>0?(await a.TrackingEvent(i,r).deleteMany({_id:{$in:[...c.map(e=>e._id)]}}),m(n.default.differenceWith(t,c,(e,n)=>e.name===n.name))):m(t)})}function c(e){return r.SchemaTrackingEvent.findOne({gtmVersion:e}).sort({_id:1})}exports.getTrackingEventSchema=t.default(c,{maxAge:6e4}),exports.getTrackingEventData=t.default(m,{maxAge:6e4}),exports.getUpdatedProp=t.default(u,{maxAge:6e4});
},{"../../models/trackingEvent":"Ytvl","../../models/schemaTrackingEvent":"bLgw","./trackingEventProps":"sUtY"}],"J2kM":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("express")),a=e.default.Router(),r=require("../helper/other"),n=require("../helper/dbXmlQuery"),s=require("../helper/TrackingEvent/getTrackingEventData"),i=require("../api/gtm"),u=require("../models/trackingEvent"),d=t(require("../middleware/auth"));a.get("/",[d.default],r.asyncRouteHandler(async(t,e)=>{const{display:a}=t.query,{username:d,password:o,instance:l,url:c}=t.user,g=d.split(".")[0];if(a){const t=await u.TrackingEvent(g,l).find({display:a}).sort({_id:1});if(t.length)return e.status(200).json({data:t})}const p=+t.query.gtmVersion||+r.CONSTS.GTMVERSION,f=await s.getTrackingEventSchema(p);if(!f)return e.status(400).send(`gtmVersion:${p} schema not available!`);const{data:v,error:m}=await r.asyncHandler(i.dbXml(c,n.getTrackingEventPropfromOtm,d,o));if(m)return e.status(400).send(m);const y=await s.getTrackingEventData(f,p,v);let E=await u.TrackingEvent(g,l).find({}).sort({_id:1});return E&&0!==E.length?(E=await s.getUpdatedProp(y,E,l,g),a?e.status(200).json({data:E.filter(t=>t.display)}):e.status(200).json({data:E})):e.status(200).json({data:await u.TrackingEvent(g,l).insertMany(y)})})),a.put("/",[d.default],r.asyncRouteHandler(async(t,e)=>{const{instance:a,username:r}=t.user,n=r.split(".")[0];let{trackingEvent:s}=t.body;return s?(s=await u.TrackingEvent(n,a).findByIdAndUpdate(s._id,s,{new:!0}),e.status(200).json({data:s})):e.status(400).send("Tracking Event prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/TrackingEvent/getTrackingEventData":"GO0I","../api/gtm":"KJs0","../models/trackingEvent":"Ytvl","../middleware/auth":"MNoc"}],"e4o2":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../renamer"),a=e(require("lodash")),r=require("../other"),u=e=>{const t={};return a.default.keys(e).map(e=>n(e,t)).filter(e=>void 0!==e),t},n=(e,t)=>{switch(!0){case-1!==e.search("Refnum"):i(e,t,"Refnum");break;default:i(e,t,"Header")}return t};exports.getChilds=(e=>{const t={ShipmentStatus:{}};return a.default.keys(e).map(a=>{switch(!0){case-1===a.search("ShipmentStatus"):break;default:s(a,e,t,"ShipmentStatus")}return t}).filter(e=>void 0!==e),t.ShipmentStatus=u(t.ShipmentStatus),{ShipmentStatus:t.ShipmentStatus}});const s=(e,t,a,r)=>{a[`${r}`][`${e}`]=t[`${e}`]},i=(e,u,n)=>{let s=e,i=e;switch(!0){case"Refnum"===n:s=r.convertPath(e,"Refnum").newPath,i=r.convertPath(e,"Refnum").newName}u[`${n}`]||(u[`${n}`]=[]),u[`${n}`].push({name:t.getElementName(i),path:s}),u[`${n}`]=a.default.uniqBy(u[`${n}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"WFgW":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./../index"),n=e(require("express")),r=n.default.Router(),a=e(require("path")),s=e(require("fast-xml-parser")),i=e(require("flat")),u=require("../helper/other"),o=require("../helper/TrackingEvent/schemaTrackingEventProps"),c=require("../models/schemaTrackingEvent");r.post("/",u.asyncRouteHandler(async(e,n)=>{const r=a.default.join(t.ROOT_DIR,"XMLs","TrackingEvent.xml"),l=await u.getFileData(r),m=s.default.getTraversalObj(l,{}),d=s.default.convertToJson(m,{}),g=i.default(d),f=o.getChilds(g),{gtmVersion:h,xmlNsOtm:v,xmlNsGtm:p}=u.getXMlVersion(l);if(!h)return n.status(400).send("XML must contain Namespace");let T=await c.SchemaTrackingEvent.findOne({gtmVersion:h});if(T){if(JSON.stringify(T.ShipmentStatus)===JSON.stringify(f.ShipmentStatus))return n.status(200).send(T);await c.SchemaTrackingEvent.findByIdAndRemove(T._id)}return T=new c.SchemaTrackingEvent({xmlNs:[v,p],gtmVersion:h,...f}),T=await T.save(),n.status(200).send(T)})),r.get("/",u.asyncRouteHandler(async(e,t)=>{const{gtmVersion:n}=e.query;if(!n){const e=await c.SchemaTrackingEvent.find().sort({gtmVersion:-1});return t.status(200).send(e)}const r=await c.SchemaTrackingEvent.findOne({gtmVersion:n});return r?t.status(200).send(r):t.status(400).send(`gtmVersion:${n} schema not available!`)})),exports.default=r;
},{"./../index":"Focm","../helper/other":"irtd","../helper/TrackingEvent/schemaTrackingEventProps":"e4o2","../models/schemaTrackingEvent":"bLgw"}],"RymQ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),i=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]});exports.Shipment=((e,n)=>t.default.model("Shipment",i,`${e}_Shipment_${n}`));
},{}],"Tn9S":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),i=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},ActualShipment:{type:"Mixed"}});exports.SchemaShipment=t.default.model("SchemaShipment",i,"ShipmentSchema");
},{}],"TZ3U":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../other"),a=require("../renamer"),t=require("../other"),n=["Shipment ID DomainName","Shipment ID","Shipment TransactionCode","Transport Mode ID","Stop Sequence","Location ID DomainName","Location ID","Activity","ShipUnit ID","ShipUnit ID DomainName",...Object.values(t.NAME.shipment)],p=(a,t,n)=>{const p=e.capitalize(n.split("_").join(" "));return p.split(".")[1]?p.split(".")[1]:p},r=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};for(let i=0;i<e.getSequence.length;i++){e.getSequence[i]}exports.mapHeader=((e,t,p,r,i)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,n),display:a.getMandatoryElement(e.name,n),type:t,displayText:e.name,defaultValue:a.getDefaultValue(e.path,i),path:[e.path],gtmVersion:p,xmlNs:r})),exports.mapRefnum=((t,n,i,l,m,o,s)=>{const u=r(n,"Xid"),d=r(n,"DomainName"),c=r(n,"RefnumValue"),h=r(n,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:i,displayText:p(0,0,t),defaultValue:a.getDefaultValue(n[c].path,s),path:[{path:n[c].path.replace("INDEX",o),value:""},e.getDomainName(t,n[d].path.replace("INDEX",o)),e.getTC(t,n[h].path.replace("INDEX",o)),e.getXID(t,n[u].path.replace("INDEX",o))],gtmVersion:l,xmlNs:m}}),exports.mapRemark=((t,n,i,l,m,o,s)=>{const u=r(n,"Xid"),d=r(n,"DomainName"),c=r(n,"RemarkText"),h=r(n,"RemarkSequence"),D=r(n,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:i,displayText:p(0,0,t),defaultValue:a.getDefaultValue(n[c].path,s),path:[{path:n[c].path.replace("INDEX",o),value:""},e.getTC(t,n[D].path.replace("INDEX",o)),e.getSequence(t,n[h].path.replace("INDEX",o),o),e.getDomainName(t,n[d].path.replace("INDEX",o)),e.getXID(t,n[u].path.replace("INDEX",o))],gtmVersion:l,xmlNs:m}});
},{"../other":"irtd","../renamer":"jN2X"}],"MdE1":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("lodash")),n=e(require("promise-memoize")),a=require("../../models/shipment"),i=require("../../models/schemaShipment"),m=require("./shipmentProps");function r(e,n,a,i){return new Promise(function(r){let{Header:p,Remark:u,Refnum:s}=e.ActualShipment.Shipment,{Header:d}=e.ActualShipment.ShipmentStop,{Header:o}=e.ActualShipment.ShipUnit;const h=e.xmlNs;p=p.map(e=>m.mapHeader(e,"Shipment : Header",n,h,i)),d=d.map(e=>m.mapHeader(e,"Shipment Stop : Header",n,h,i)),o=o.map(e=>m.mapHeader(e,"ShipUnit : Header",n,h,i));const f=a.match(/REMARKS="(.*?)"/)[1].split(",");u=f.map((e,t)=>m.mapRemark(e,u,"Shipment : Remark",n,h,t,i));const c=a.match(/SHIPMENT_REFNUMS="(.*?)"/)[1].split(",");s=c.map((e,t)=>m.mapRefnum(e,s,"Shipment : Refnum",n,h,t,i)),r(t.default.uniqBy([...p,...u,...s,...d,...o],e=>e.name))})}function p(e,n,i,m){return new Promise(async function(r){const p=t.default.differenceWith(e,n,(e,t)=>e.name===t.name),u=t.default.differenceWith(n,e,(e,t)=>e.name===t.name);if(p.length>0){const e=await a.Shipment(m,i).insertMany(p);r([...n,...e])}else u.length>0?(await a.Shipment(m,i).deleteMany({_id:{$in:[...u.map(e=>e._id)]}}),r(t.default.differenceWith(n,u,(e,t)=>e.name===t.name))):r(n)})}function u(e){return i.SchemaShipment.findOne({gtmVersion:e}).sort({_id:1})}exports.getShipmentSchema=n.default(u,{maxAge:6e4}),exports.getShipmentData=n.default(r,{maxAge:6e4}),exports.getUpdatedProp=n.default(p,{maxAge:6e4});
},{"../../models/shipment":"RymQ","../../models/schemaShipment":"Tn9S","./shipmentProps":"TZ3U"}],"Dxzj":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("express")),a=t.default.Router(),s=require("../helper/other"),r=require("../helper/dbXmlQuery"),n=require("../helper/Shipment/getShipmentData"),i=require("../api/gtm"),u=require("../models/shipment"),d=e(require("../middleware/auth"));a.get("/",[d.default],s.asyncRouteHandler(async(e,t)=>{const{display:a}=e.query,{username:d,password:o,instance:l,url:p}=e.user,m=d.split(".")[0];if(a){const e=await u.Shipment(m,l).find({display:a}).sort({_id:1});if(e.length)return t.status(200).json({data:e})}const h=+e.query.gtmVersion||+s.CONSTS.GTMVERSION,c=await n.getShipmentSchema(h);if(!c)return t.status(400).send(`gtmVersion:${h} schema not available!`);const{data:f,error:y}=await s.asyncHandler(i.dbXml(p,r.getShipmentPropsfromGtm,d,o));if(y)return t.status(400).send(y);const S=await n.getShipmentData(c,h,f,m),g=await u.Shipment(m,l).find({}).sort({_id:1});return g&&0!==g.length?a?t.status(200).json({data:g.filter(e=>e.display)}):t.status(200).json({data:g}):t.status(200).json({data:await u.Shipment(m,l).insertMany(S)})})),a.put("/",[d.default],s.asyncRouteHandler(async(e,t)=>{let{shipment:a}=e.body;const{username:s,instance:r}=e.user,n=s.split(".")[0];return a?(a=await u.Shipment(n,r).findByIdAndUpdate(a._id,a,{new:!0}),t.status(200).json({data:a})):t.status(400).send("Shipment prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Shipment/getShipmentData":"MdE1","../api/gtm":"KJs0","../models/shipment":"RymQ","../middleware/auth":"MNoc"}],"IbzE":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../renamer"),n=e(require("lodash")),a=require("../other"),r=e=>{const t={};return n.default.keys(e).map(e=>i(e,t)).filter(e=>void 0!==e),t},i=(e,t)=>{switch(!0){case-1!==e.search("Remark"):p(e,t,"Remark");break;case-1!==e.search("Refnum"):p(e,t,"Refnum");break;default:p(e,t,"Header")}return t};exports.getChilds=(e=>{const t={Shipment:{},ShipmentStop:{},ShipUnit:{}};return n.default.keys(e).map(n=>{switch(!0){case-1===n.search("ActualShipment"):break;case-1!==n.search("ShipmentStop"):h(n,e,t,"ShipmentStop");break;case-1!==n.search("ShipUnit"):h(n,e,t,"ShipUnit");break;default:h(n,e,t,"Shipment")}return t}).filter(e=>void 0!==e),t.Shipment=r(t.Shipment),t.ShipmentStop=r(t.ShipmentStop),t.ShipUnit=r(t.ShipUnit),t.Shipment.ShipmentStop={...t.ShipmentStop},t.Shipment.ShipUnit={...t.ShipUnit},{ActualShipment:t}});const h=(e,t,n,a)=>{n[`${a}`][`${e}`]=t[`${e}`]},p=(e,r,i)=>{let h=e,p=e;switch(!0){case"Remark"===i:h=a.convertPath(e,"Remark").newPath,p=a.convertPath(e,"Remark").newName;break;case"Refnum"===i:h=a.convertPath(e,"Refnum").newPath,p=a.convertPath(e,"Refnum").newName}r[`${i}`]||(r[`${i}`]=[]),r[`${i}`].push({name:t.getElementName(p),path:h}),r[`${i}`]=n.default.uniqBy(r[`${i}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"oS06":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./../index"),s=e(require("express")),n=s.default.Router(),a=e(require("path")),r=e(require("fast-xml-parser")),i=e(require("flat")),u=require("../helper/other"),m=require("../helper/Shipment/schemaShipmentProps"),o=require("../models/schemaShipment");n.post("/",u.asyncRouteHandler(async(e,s)=>{const n=a.default.join(t.ROOT_DIR,"XMLs","ActualShipment.xml"),l=await u.getFileData(n),d=r.default.getTraversalObj(l,{}),c=r.default.convertToJson(d,{}),h=i.default(c),p=m.getChilds(h),{gtmVersion:f,xmlNsOtm:S,xmlNsGtm:g}=u.getXMlVersion(l);if(!f)return s.status(400).send("XML must contain Namespace");let q=await o.SchemaShipment.findOne({gtmVersion:f});if(q){if(JSON.stringify(q.ActualShipment)===JSON.stringify(p.ActualShipment))return s.status(200).send(q);await o.SchemaShipment.findByIdAndRemove(q._id)}return q=new o.SchemaShipment({xmlNs:[S,g],gtmVersion:f,...p}),q=await q.save(),s.status(200).send(q)})),n.get("/",u.asyncRouteHandler(async(e,t)=>{const{gtmVersion:s}=e.query;if(!s){const e=await o.SchemaShipment.find().sort({gtmVersion:-1});return t.status(200).send(e)}const n=await o.SchemaShipment.findOne({gtmVersion:s});return n?t.status(200).send(n):t.status(400).send(`gtmVersion:${s} schema not available!`)})),exports.default=n;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Shipment/schemaShipmentProps":"IbzE","../models/schemaShipment":"Tn9S"}],"yqlE":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),o=new t.default.Schema({name:{type:"String"},required:{type:"Boolean"},disabled:{type:"Boolean"},display:{type:"Boolean"},type:{type:"String"},displayText:{type:"String"},defaultValue:{type:"String"},path:{type:["Mixed"]},xmlNs:{type:["String"]},gtmVersion:{type:"Number"}});exports.Bom=((e,r)=>t.default.model("Bom",o,`${e}_Bom_${r}`));
},{}],"fhQn":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("mongoose")),o=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},Bom:{type:"Mixed"}});exports.SchemaBom=t.default.model("SchemaBom",o,"BomSchema");
},{}],"d1Ga":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../other"),a=require("../renamer"),t=require("../other"),r=["Bom TransactionCode","Bom ID DomainName","Bom ID","Item ID DomainName","Item ID",...Object.values(t.NAME.bom)],p=(a,t,r)=>{const p=e.capitalize(r.split("_").join(" "));return p.split(".")[1]?p.split(".")[1]:p},l=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};for(let n=0;n<e.getSequence.length;n++){e.getSequence[n]}exports.mapHeader=((e,t,p,l,n)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,r),display:a.getMandatoryElement(e.name,r),type:t,displayText:e.name,defaultValue:a.getDefaultValue(e.path,n),path:[e.path],gtmVersion:p,xmlNs:l})),exports.mapRefnum=((t,r,n,i,m,o,d,u)=>{const s=l(r,"Xid"),c=l(r,"DomainName"),h=l(r,"RefnumValue"),D=l(r,"TransactionCode");return{name:`${d} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${d} ${p(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(r[h].path,u),path:[{path:r[h].path.replace("INDEX",o),value:""},e.getDomainName(t,r[c].path.replace("INDEX",o)),e.getTC(t,r[D].path.replace("INDEX",o)),e.getXID(t,r[s].path.replace("INDEX",o))],gtmVersion:i,xmlNs:m}}),exports.mapRemark=((t,r,n,i,m,o,d,u)=>{const s=l(r,"Xid"),c=l(r,"DomainName"),h=l(r,"RemarkText"),D=l(r,"RemarkSequence"),I=l(r,"TransactionCode");return{name:`${d} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${d} ${p(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(r[h].path,u),path:[{path:r[h].path.replace("INDEX",o),value:""},e.getTC(t,r[I].path.replace("INDEX",o)),e.getSequence(t,r[D].path.replace("INDEX",o),o),e.getDomainName(t,r[c].path.replace("INDEX",o)),e.getXID(t,r[s].path.replace("INDEX",o))],gtmVersion:i,xmlNs:m}}),exports.mapInvolvedParty=((t,r,n,i,m,o,d,u="")=>{const s=l(r,/InvolvedPartyQualifierGid(.*?)Xid/),c=l(r,/ContactGid(.*?)Xid/),h=l(r,/ContactGid(.*?)DomainName/),D=l(r,"TransactionCode");return{name:`${d} ${t} Contact ID`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${d} ${p(0,0,t)} Contact ID`.trim(),defaultValue:a.getDefaultValue(r[c].path,u),path:[{path:r[c].path,value:""},e.getTC(t,r[D].path),{path:r[h].path,value:u},e.getXID(t,r[s].path)],gtmVersion:i,xmlNs:m}});
},{"../other":"irtd","../renamer":"jN2X"}],"KGb3":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const m=e(require("lodash")),t=e(require("promise-memoize")),a=require("../../models/bom"),n=require("../../models/schemaBom"),o=require("./bomProps");function r(e,t,a,n){return new Promise(function(r){let{Header:i,Remark:s,Refnum:p,InvolvedParty:u}=e.Bom.Bom,{Header:d,Remark:f,Refnum:l}=e.Bom.BomComponent;const c=e.xmlNs;i=i.map(e=>o.mapHeader(e,"Bom : Header",t,c,n)),d=d.map(e=>o.mapHeader(e,"Bom Component : Header",t,c,n));const B=a.match(/REMARKS="(.*?)"/)[1].split(",");s=B.map((e,m)=>o.mapRemark(e,s,"Bom : Remark",t,c,m,"",n)),f=B.map((e,m)=>o.mapRemark(e,f,"Bom Component : Remark",t,c,m,"Component",n));const R=a.match(/REFNUMS="(.*?)"/)[1].split(",");p=R.map((e,m)=>o.mapRefnum(e,p,"Bom : Refnum",t,c,m,"",n));const h=a.match(/COMPONENT_REFNUMS="(.*?)"/)[1].split(",");l=h.map((e,m)=>o.mapRefnum(e,l,"Bom Component : Refnum",t,c,m,"Component",n));const _=a.match(/INVOLVED_PARTY="(.*?)"/)[1].split(",");u=_.map((e,m)=>o.mapInvolvedParty(e,u,"Bom : Involved Party",t,c,m,"",n)),r(m.default.uniqBy([...i,...s,...p,...u,...d,...f,...l],e=>e.name))})}function i(e,t,n,o){return new Promise(async function(r){const i=m.default.differenceWith(e,t,(e,m)=>e.name===m.name),s=m.default.differenceWith(t,e,(e,m)=>e.name===m.name);if(i.length>0){const e=await a.Bom(o,n).insertMany(i);r([...t,...e])}else s.length>0?(await a.Bom(o,n).deleteMany({_id:{$in:[...s.map(e=>e._id)]}}),r(m.default.differenceWith(t,s,(e,m)=>e.name===m.name))):r(t)})}function s(e){return n.SchemaBom.findOne({gtmVersion:e}).sort({_id:1})}exports.getBomSchema=t.default(s,{maxAge:6e4}),exports.getBomData=t.default(r,{maxAge:6e4}),exports.getUpdatedProp=t.default(i,{maxAge:6e4});
},{"../../models/bom":"yqlE","../../models/schemaBom":"fhQn","./bomProps":"d1Ga"}],"jRt1":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../renamer"),r=e(require("lodash")),a=require("../other"),n=e=>{const t={};return r.default.keys(e).map(e=>o(e,t)).filter(e=>void 0!==e),t},o=(e,t)=>{switch(!0){case-1!==e.search("InvolvedParty"):s(e,t,"InvolvedParty");break;case-1!==e.search("Remark"):s(e,t,"Remark");break;case-1!==e.search("Refnum"):s(e,t,"Refnum");break;default:s(e,t,"Header")}return t};exports.getChilds=(e=>{const t={Bom:{},BomComponent:{}};return r.default.keys(e).map(r=>{switch(!0){case-1===r.search("GtmStructure"):break;case-1!==r.search("GtmStructureComponent"):m(r,e,t,"BomComponent");break;default:m(r,e,t,"Bom")}return t}).filter(e=>void 0!==e),t.Bom=n(t.Bom),t.BomComponent=n(t.BomComponent),{Bom:t}});const m=(e,t,r,a)=>{r[`${a}`][`${e}`]=t[`${e}`]},s=(e,n,o)=>{let m=e,s=e;switch(!0){case"InvolvedParty"===o:m=a.convertPath(e,"InvolvedParty").newPath,s=a.convertPath(e,"InvolvedParty").newName;break;case"Remark"===o:m=a.convertPath(e,"Remark").newPath,s=a.convertPath(e,"Remark").newName;break;case"Refnum"===o:m=a.convertPath(e,"Refnum").newPath,s=a.convertPath(e,"Refnum").newName}n[`${o}`]||(n[`${o}`]=[]),n[`${o}`].push({name:t.getElementName(s),path:m}),n[`${o}`]=r.default.uniqBy(n[`${o}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"Rmix":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./../index"),s=e(require("express")),r=s.default.Router(),a=e(require("path")),n=e(require("fast-xml-parser")),o=e(require("flat")),i=require("../helper/other"),m=require("../helper/Bom/schemaBomProps"),u=require("../models/schemaBom");async function l(){const e=a.default.join(t.ROOT_DIR,"XMLs","GtmStructure.xml"),s=await i.getFileData(e),r=n.default.getTraversalObj(s,{}),l=n.default.convertToJson(r,{}),d=o.default(l),c=m.getChilds(d);let{gtmVersion:f,xmlNsOtm:g,xmlNsGtm:h}=i.getXMlVersion(s);return f||(f=Number(i.CONSTS.GTMVERSION)),new u.SchemaBom({xmlNs:[g,h],gtmVersion:f,...c}).save()}r.post("/",i.asyncRouteHandler(async(e,s)=>{const r=a.default.join(t.ROOT_DIR,"XMLs","GtmStructure.xml"),l=await i.getFileData(r),d=n.default.getTraversalObj(l,{}),c=n.default.convertToJson(d,{}),f=o.default(c),g=m.getChilds(f),{gtmVersion:h,xmlNsOtm:O,xmlNsGtm:x}=i.getXMlVersion(l);if(!h)return s.status(400).send("XML must contain Namespace");let S=await u.SchemaBom.findOne({gtmVersion:h});if(S){if(JSON.stringify(S.Bom)===JSON.stringify(g.Bom))return s.status(200).send(S);await u.SchemaBom.findByIdAndRemove(S._id)}return S=new u.SchemaBom({xmlNs:[O,x],gtmVersion:h,...g}),S=await S.save(),s.status(200).send(S)})),r.get("/",i.asyncRouteHandler(async(e,t)=>{const{gtmVersion:s}=e.query;if(!s){const e=await u.SchemaBom.find().sort({gtmVersion:-1});return t.status(200).send(e)}const r=await u.SchemaBom.findOne({gtmVersion:s});return r?t.status(200).send(r):t.status(400).send(`gtmVersion:${s} schema not available!`)})),exports.default=r,exports.generateBomSchema=l;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Bom/schemaBomProps":"jRt1","../models/schemaBom":"fhQn"}],"ZKMQ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("express")),a=t.default.Router(),r=require("../helper/other"),s=require("../helper/dbXmlQuery"),n=require("../helper/Bom/getBomData"),o=require("../api/gtm"),i=require("../models/bom"),u=e(require("../middleware/auth")),d=require("./schemaBom");function l(e){return e.query.gtmVersion?+e.query.gtmVersion:+r.CONSTS.GTMVERSION}a.get("/",[u.default],r.asyncRouteHandler(async(e,t)=>{const{display:a}=e.query,{username:u,password:m,instance:p,url:c}=e.user,f=u.split(".")[0];if(a){const e=await i.Bom(f,p).find({display:a}).sort({_id:1});if(e.length)return t.status(200).json({data:e})}const y=l(e);let g=await n.getBomSchema(y);g||(g=await d.generateBomSchema());const{data:B,error:h}=await r.asyncHandler(o.dbXml(c,s.getBomPropsfromGtm,u,m));if(h)return t.status(400).send(h);const w=await n.getBomData(g,y,B,f);let q=await i.Bom(f,p).find({}).sort({_id:1});return q&&0!==q.length?(q=await n.getUpdatedProp(w,q,p,f),a?t.status(200).json({data:q.filter(e=>e.display)}):t.status(200).json({data:q})):t.status(200).json({data:await i.Bom(f,p).insertMany(w)})})),a.put("/",[u.default],r.asyncRouteHandler(async(e,t)=>{let{bom:a}=e.body;const{username:r,instance:s}=e.user,n=r.split(".")[0];return a?(a=await i.Bom(n,s).findByIdAndUpdate(a._id,a,{new:!0}),t.status(200).json({data:a})):t.status(400).send("Bom prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Bom/getBomData":"KGb3","../api/gtm":"KJs0","../models/bom":"yqlE","../middleware/auth":"MNoc","./schemaBom":"Rmix"}],"BW02":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("body-parser")),u=e(require("../routes/auth")),a=e(require("../routes/user")),t=e(require("../routes/transmission")),s=e(require("../routes/orderRelease")),i=e(require("../middleware/error")),o=e(require("../routes/schemaItem")),d=e(require("../routes/schemaRelease")),l=e(require("../routes/item")),n=e(require("../routes/location")),m=e(require("../routes/schemaLocation")),c=e(require("../routes/party")),p=e(require("../routes/schemaParty")),f=e(require("../routes/transaction")),h=e(require("../routes/schemaTransaction")),q=e(require("../routes/orderBase")),b=e(require("../routes/schemaOrderBase")),g=e(require("../routes/audit")),v=e(require("../routes/setting")),y=e(require("../routes/trackingEvent")),_=e(require("../routes/schemaTrackingEvent")),k=e(require("../routes/shipment")),x=e(require("../routes/schemaShipment")),B=e(require("../routes/bom")),j=e(require("../routes/schemaBom"));function E(e){e.use(r.default.json({limit:"50mb"})),e.use(r.default.urlencoded({limit:"50mb",extended:!0})),e.use("/api/auth",u.default),e.use("/api/user",a.default),e.use("/api/audit",g.default),e.use("/api/item",l.default),e.use("/api/order-release",s.default),e.use("/api/location",n.default),e.use("/api/party",c.default),e.use("/api/bom",B.default),e.use("/api/transaction",f.default),e.use("/api/order-base",q.default),e.use("/api/tracking-event",y.default),e.use("/api/shipment",k.default),e.use("/api/schema/item",o.default),e.use("/api/schema/order-release",d.default),e.use("/api/schema/location",m.default),e.use("/api/schema/party",p.default),e.use("/api/schema/bom",j.default),e.use("/api/schema/transaction",h.default),e.use("/api/schema/order-base",b.default),e.use("/api/schema/tracking-event",_.default),e.use("/api/schema/shipment",x.default),e.use("/api/transmission",t.default),e.use("/api/settings",v.default),e.use(i.default)}exports.default=E;
},{"../routes/auth":"hXw8","../routes/user":"zMRv","../routes/transmission":"oAdS","../routes/orderRelease":"aCHs","../middleware/error":"mbXe","../routes/schemaItem":"RPHv","../routes/schemaRelease":"woBX","../routes/item":"o5f2","../routes/location":"pk3O","../routes/schemaLocation":"ZmvT","../routes/party":"TT7J","../routes/schemaParty":"abiS","../routes/transaction":"F2tt","../routes/schemaTransaction":"DV7a","../routes/orderBase":"Xt3B","../routes/schemaOrderBase":"KJCd","../routes/audit":"YYHk","../routes/setting":"UddP","../routes/trackingEvent":"J2kM","../routes/schemaTrackingEvent":"WFgW","../routes/shipment":"Dxzj","../routes/schemaShipment":"oS06","../routes/bom":"ZKMQ","../routes/schemaBom":"Rmix"}],"K5BP":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("winston")),o=e(require("mongoose")),n=require("../helper/other");function r(){const e=n.CONSTS.DB;o.default.connect(e,{useNewUrlParser:!0,useCreateIndex:!0,useFindAndModify:!1,useUnifiedTopology:!0}).then(()=>t.default.info(`Connected to ${e}...`))}exports.default=r;
},{"../helper/other":"irtd"}],"GM52":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../helper/other");function r(){if(!e.CONSTS.JWT_PRIVATE_KEY)throw new Error("FATAL ERROR: jwtPrivateKey is not defined.")}exports.default=r;
},{"../helper/other":"irtd"}],"Q010":[function(require,module,exports) {
"use strict";var e=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("joi")),i=t(require("joi-objectid"));function u(){r.objectId=i.default(r)}exports.default=u;
},{}],"uPYR":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("helmet")),u=e(require("compression"));function r(e){e.use(t.default()),e.use(u.default())}exports.default=r;
},{}],"DxCk":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("./logging")),t=e(require("./routes")),u=e(require("./db")),i=e(require("./config")),d=e(require("./validation")),l=e(require("./prod"));exports.default=(e=>{r.default(),t.default(e),u.default(),i.default(),d.default(),l.default(e)});
},{"./logging":"yaW9","./routes":"BW02","./db":"K5BP","./config":"GM52","./validation":"Q010","./prod":"uPYR"}],"Focm":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("winston")),r=e(require("express")),u=e(require("cors")),i=e(require("./startup")),s=e(require("body-parser")),n=e(require("path")),o=r.default();o.use(u.default()),o.use(s.default.json()),i.default(o),o.use(r.default.static(n.default.join(__dirname,"public"))),o.get("*",(e,t)=>t.sendFile(n.default.join(__dirname,"public","index.html")));const a=process.env.PORT||5e3,d=o.listen(a,l());function l(){return()=>t.default.info(`Listening on port ${a}...`)}exports.default=d,exports.ROOT_DIR=__dirname;
},{"./startup":"DxCk"}]},{},["Focm"], null)